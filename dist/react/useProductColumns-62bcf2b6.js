import{n as k,a9 as F,aT as P,aU as j,j as $,a as c,z as B,d as L,y as O,aV as T,F as y,aW as R,h as x,aX as A,G as h,aI as C,aH as N,C as q,aY as b}from"./index-ecbcc3c7.js";import{r as g}from"./react-e483b31d.js";import{I as p}from"./InvoiceViewer-a729b03c.js";import"./classnames-eea0979a.js";import"./react-debounce-input-20b6d49d.js";import"./react-redux-7b717b6c.js";import{u as E}from"./react-i18next-91d47f13.js";import{y as S}from"./lodash-bd2b80f6.js";function I(){var e,r;const[t]=E(),l=k(),{isOwner:a}=F();return!P()&&!j()&&a?$("div",{className:"flex text-base space-x-1",children:[c(B,{className:"capitalize",to:((e=l==null?void 0:l.company_user)==null?void 0:e.ninja_portal_url)||L("/settings/account_management"),setBaseFont:!0,external:!!((r=l==null?void 0:l.company_user)!=null&&r.ninja_portal_url),children:t("click_here")}),$("span",{children:[O("pro_plan_remove_logo",{link:""}),"."]})]}):null}function Z(t){var n,i,f,u,o,_,s;const[l,a]=g.useState(!1),e=t.endpoint||"/api/v1/live_preview?entity=:entity",r=g.useRef(null);return g.useEffect(()=>{if(!t.observable)return;const d=new IntersectionObserver(m=>{m.forEach(w=>{w.isIntersecting?a(!0):a(!1)},{threshold:.1})});return r.current&&d.observe(r.current),()=>{d.disconnect()}},[r.current]),g.useEffect(()=>{t.observable},[t.resource]),(n=t.resource)!=null&&n[t.relationType]&&t.for==="create"?c("div",{ref:r,children:c(p,{link:T(e,{entity:t.entity}),resource:t.resource,method:"POST"})}):(i=t.resource)!=null&&i.id&&((f=t.resource)!=null&&f[t.relationType])&&t.entity==="purchase_order"?$("div",{className:"flex flex-col space-y-3",children:[c(p,{link:T("/api/v1/live_preview/purchase_order?entity=:entity&entity_id=:id",{entity:t.entity,id:(u=t.resource)==null?void 0:u.id}),resource:t.resource,method:"POST"}),t.withRemoveLogoCTA&&c(I,{})]}):(o=t.resource)!=null&&o.id&&((_=t.resource)!=null&&_[t.relationType])&&t.for==="invoice"?$("div",{className:"flex flex-col space-y-3",children:[c("div",{ref:r,children:c(p,{link:T("/api/v1/live_preview?entity=:entity&entity_id=:id",{entity:t.entity,id:(s=t.resource)==null?void 0:s.id}),method:"POST",resource:t.resource,enabled:t.observable?l:!0})}),t.withRemoveLogoCTA&&c(I,{})]}):c(y,{})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://opensource.org/licenses/AAL
 */function D(t){const[l,a]=t.split("$");return{dollar:l,property:a}}function M(t){const l=R({resource:t.resource,relationType:t.relationType}),a=t.resource,e=x(),r=(u,o)=>t.onChange(u,o),n=A(),i=t.invoiceSum,f={total:"amount",outstanding:"balance"};return u=>{let o=0;const{property:_}=D(u),s=f[_]||_;return u=="$net_subtotal"&&i?c(h,{leftSide:n(u,"$"),children:l(i.subTotal)}):u=="$discount"&&i?i.totalDiscount!=0?c(h,{leftSide:n(u,"$"),children:l(i.totalDiscount)}):"":u=="$subtotal"&&i?c(h,{leftSide:n(u,"$"),children:l(i.subTotal)}):u=="$total_taxes"&&i?c(h,{leftSide:n(u,"$"),children:l(i.totalTaxes)}):u=="$line_taxes"&&i?c(h,{leftSide:n(u,"$"),children:l(i.invoiceItems.totalTaxes)}):u=="$total"&&i?c(h,{leftSide:n(u,"$"),children:l(i.total)}):u=="$paid_to_date"&&i?c(h,{leftSide:n(u,"$"),children:l(i.invoice.paid_to_date)}):u=="$balance_due"&&i?c(h,{leftSide:n(u,"$"),children:l(i.getBalanceDue())}):u=="$taxes"&&i?c(y,{children:i==null?void 0:i.getTaxMap().map((d,m)=>c(h,{leftSide:d.name,children:c("span",{children:l(d.total)})},m))}):u==="$custom_surcharge1"?c(C,{field:"surcharge1",defaultValue:(a==null?void 0:a.custom_surcharge1)||"",value:(e==null?void 0:e.custom_fields.surcharge1)||"",onValueChange:d=>r("custom_surcharge1",d)}):u==="$custom_surcharge2"?c(C,{field:"surcharge2",defaultValue:(a==null?void 0:a.custom_surcharge2)||"",value:(e==null?void 0:e.custom_fields.surcharge2)||"",onValueChange:d=>r("custom_surcharge2",d)}):u==="$custom_surcharge3"?c(C,{field:"surcharge3",defaultValue:(a==null?void 0:a.custom_surcharge3)||"",value:(e==null?void 0:e.custom_fields.surcharge3)||"",onValueChange:d=>r("custom_surcharge3",d)}):u==="$custom_surcharge4"?c(C,{field:"surcharge4",defaultValue:(a==null?void 0:a.custom_surcharge4)||"",value:(e==null?void 0:e.custom_fields.surcharge4)||"",onValueChange:d=>r("custom_surcharge4",d)}):(a&&(o=a[s]??0),c(h,{leftSide:n(s,"$"),children:l(o)}))}}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function z(){const t=x(),[l,a]=g.useState([]);return g.useEffect(()=>{var r,n,i,f;let e=["$subtotal"];(r=t==null?void 0:t.custom_fields)!=null&&r.surcharge1||(e=e.filter(u=>u!=="$custom_surcharge1")),(n=t==null?void 0:t.custom_fields)!=null&&n.surcharge2||(e=e.filter(u=>u!=="$custom_surcharge2")),(i=t==null?void 0:t.custom_fields)!=null&&i.surcharge3||(e=e.filter(u=>u!=="$custom_surcharge3")),(f=t==null?void 0:t.custom_fields)!=null&&f.surcharge4||(e=e.filter(u=>u!=="$custom_surcharge4")),e.push("$discount"),e.push("$total"),e.push("$paid_to_date"),e.push("$balance_due"),e.push("$taxes"),a(e)},[t]),l}function V(t){const[l,a]=g.useState(""),e=x();return g.useEffect(()=>{const[r]=[e.custom_fields[t.field],""];a(r||"")},[]),c(h,{leftSide:l,children:c(N,{...t})})}function ee(t){var f,u,o,_;const l=z(),a=x(),e=t.resource,r=M({resource:e,onChange:t.onChange,invoiceSum:t.invoiceSum,relationType:t.relationType}),n=(s,d)=>t.onChange(s,d),[i]=E();return $(q,{className:"col-span-12 xl:col-span-4 h-max",children:[l.map((s,d)=>(s==="$subtotal"||s==="$taxes")&&c(g.Fragment,{children:r(s)},d)),a&&a.enabled_tax_rates>0&&c(h,{leftSide:i("tax"),children:c(b,{defaultValue:e==null?void 0:e.tax_name1,onChange:s=>{var d,m;n("tax_name1",(d=s.resource)==null?void 0:d.name),n("tax_rate1",(m=s.resource)==null?void 0:m.rate)},onClearButtonClick:()=>{n("tax_name1",""),n("tax_rate1",0)},onTaxCreated:s=>{n("tax_name1",s.name),n("tax_rate1",s.rate)}})}),a&&a.enabled_tax_rates>1&&c(h,{leftSide:i("tax"),children:c(b,{defaultValue:e==null?void 0:e.tax_name2,onChange:s=>{var d,m;n("tax_name2",(d=s.resource)==null?void 0:d.name),n("tax_rate2",(m=s.resource)==null?void 0:m.rate)},onClearButtonClick:()=>{n("tax_name2",""),n("tax_rate2",0)},onTaxCreated:s=>{n("tax_name2",s.name),n("tax_rate2",s.rate)}})}),a&&a.enabled_tax_rates>2&&c(h,{leftSide:i("tax"),children:c(b,{defaultValue:e==null?void 0:e.tax_name3,onChange:s=>{var d,m;n("tax_name3",(d=s.resource)==null?void 0:d.name),n("tax_rate3",(m=s.resource)==null?void 0:m.rate)},onClearButtonClick:()=>{n("tax_name3",""),n("tax_rate3",0)},onTaxCreated:s=>{n("tax_name3",s.name),n("tax_rate3",s.rate)}})}),l.map((s,d)=>s!=="$subtotal"&&s!=="$taxes"&&c(g.Fragment,{children:r(s)},d)),a&&((f=a==null?void 0:a.custom_fields)==null?void 0:f.surcharge1)&&c(V,{field:"surcharge1",type:"number",defaultValue:e==null?void 0:e.custom_surcharge1,value:e==null?void 0:e.custom_surcharge1,onValueChange:s=>n("custom_surcharge1",s)}),a&&((u=a==null?void 0:a.custom_fields)==null?void 0:u.surcharge2)&&c(V,{field:"surcharge2",type:"number",defaultValue:e==null?void 0:e.custom_surcharge2,value:e==null?void 0:e.custom_surcharge2,onValueChange:s=>n("custom_surcharge2",s)}),a&&((o=a==null?void 0:a.custom_fields)==null?void 0:o.surcharge3)&&c(V,{field:"surcharge3",type:"number",defaultValue:e==null?void 0:e.custom_surcharge3,value:e==null?void 0:e.custom_surcharge3,onValueChange:s=>n("custom_surcharge3",s)}),a&&((_=a==null?void 0:a.custom_fields)==null?void 0:_.surcharge4)&&c(V,{field:"surcharge4",type:"number",defaultValue:e==null?void 0:e.custom_surcharge4,value:e==null?void 0:e.custom_surcharge4,onValueChange:s=>n("custom_surcharge4",s)})]})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */const U=(t,l,a)=>{const e=l.findIndex(n=>n===t);return e>-1?e:a.length},v=(t,l,a)=>{const e=a.slice(0,t),r=a.slice(t);return e.concat(l,r)};function te(){const t=x(),[l,a]=g.useState([]);return g.useEffect(()=>{let e=S.clone(t==null?void 0:t.settings.pdf_variables.product_columns)||[],r=S.clone(t==null?void 0:t.settings.pdf_variables.product_columns)||[];const n=r.length;e.includes("$product.item")||(e=["$product.item",...e],r=["$product.item",...r]),n||e.push("$product.description"),e.includes("$product.unit_cost")||(e.push("$product.unit_cost"),r.push("$product.unit_cost")),e.includes("$product.quantity")||(e.push("$product.quantity"),r.push("$product.quantity"));const i=[],f=(t==null?void 0:t.enabled_item_tax_rates)||0;f>0&&i.push("$product.tax_rate1"),f>1&&i.push("$product.tax_rate2"),f>2&&i.push("$product.tax_rate3");const u=U("$product.tax",r,e);e=v(u,i,e),r=v(u,i,r),e=e.filter(o=>o!=="$product.tax"),r=r.filter(o=>o!=="$product.tax"),t.enable_product_discount||(e=e.filter(o=>o!=="$product.discount"),r=r.filter(o=>o!=="$product.discount")),t.enable_product_discount&&!e.includes("$product.discount")&&(e.push("$product.discount"),r.push("$product.discount")),["product1","product2","product3","product4"].forEach(o=>{t!=null&&t.custom_fields[o]&&!r.includes(`$product.${o}`)&&(e=v(e.length,[`$product.${o}`],e)),!(t!=null&&t.custom_fields[o])&&r.includes(`$product.${o}`)&&(e=e.filter(_=>_!==`$product.${o}`),r=r.filter(_=>_!==`$product.${o}`))}),e=e.filter(o=>o!=="$product.line_total"),e.push("$product.line_total"),a(e)},[t]),l}export{ee as I,Z as a,U as g,v as i,te as u};
