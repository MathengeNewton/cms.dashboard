import{t as Y,A as j,E as Z,c as O,u as J,bw as U,b as W,r as I,e as M,a as i,R as X,j as s,T as ee,G as b,c2 as ie,c3 as te,H as ne,I as oe,J as D,K as re,O as y,P as se,Q as L,N as $,d as F,D as le,g as k,y as ae,z as G,c4 as ce,a2 as T,c5 as me,c6 as de,c7 as E,aq as ue,v as pe,c8 as he,l as _e,c9 as fe,bx as ve,by as be,x as ge,f as xe,Y as ye,Z as Se,_ as P,F as we,ca as Ce}from"./index-e5ac1c37.js";import{I as ke}from"./ImportButton-1d04ed88.js";import{D as Ae}from"./DataTableColumnsPicker-e6b5c621.js";import{c as Ne}from"./classnames-eea0979a.js";import{r as R}from"./react-e483b31d.js";import"./react-debounce-input-20b6d49d.js";import"./react-redux-7b717b6c.js";import{S as De}from"./Slider-3903b35c.js";import{a as V}from"./react-query-557fee5a.js";import{bn as K,bx as Te}from"./dayjs-75976aa4.js";import{U as Ee,x as Pe,Y as Re,Z as Fe,I as Be}from"./react-icons-071f44cd.js";import{r as qe}from"./react-string-replace-e94ae631.js";import{u as N}from"./react-i18next-91d47f13.js";import{b as Q,u as A}from"./jotai-4279821d.js";import{u as Ie}from"./useFooterColumns-c135863b.js";import{D as Me}from"./DataTableFooterColumnsPicker-ffc8e60e.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./lodash-bd2b80f6.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./@azure-485fd2d4.js";import"./react-router-82cc6afb.js";import"./@remix-run-dd360fb4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./react-router-dom-67fe6288.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./lodash.debounce-ddb7250b.js";import"./useSumTableColumn-02c51a24.js";const z=Q(null),H=Q(!1);K.extend(Te);const $e=()=>{const[c]=N();return l=>{var o,m,p,h,d;let e=ae(`activity_${l.activity_type_id}`,{});const _={client:i(G,{to:F("/clients/:id",{id:(o=l.client)==null?void 0:o.hashed_id}),children:(m=l.client)==null?void 0:m.label}),user:((p=l.user)==null?void 0:p.label)??c("system"),recurring_invoice:i(G,{to:F("/recurring_invoices/:id/edit",{id:(h=l.recurring_invoice)==null?void 0:h.hashed_id}),children:(d=l==null?void 0:l.recurring_invoice)==null?void 0:d.label})};for(const[u,f]of Object.entries(_))e=qe(e,`:${u}`,()=>f);return e}},Ge=()=>{var S,w,g,x;const[c,l]=A(H),[e,_]=A(z),[o]=N(),m=Y(),p=j(),h=Z(),d=O(),u=J(),f=U({showCommonBulkActions:!0,showEditAction:!0}),{dateFormat:v}=W(),{data:t}=V({queryKey:["/api/v1/recurring_invoices",e==null?void 0:e.id,"slider"],queryFn:()=>I("GET",M("/api/v1/recurring_invoices/:id?include=activities.history&show_dates=true",{id:e==null?void 0:e.id})).then(r=>r.data.data),enabled:e!==null&&c,staleTime:1/0}),{data:n}=V({queryKey:["/api/v1/activities/entity",e==null?void 0:e.id],queryFn:()=>I("POST",M("/api/v1/activities/entity"),{entity:"recurring_invoice",entity_id:e==null?void 0:e.id}).then(r=>r.data.data),enabled:e!==null&&c,staleTime:1/0}),a=$e();return i(De,{visible:c,onClose:()=>{l(!1),_(null)},size:"regular",title:`${o("recurring_invoice")} ${(e==null?void 0:e.number)||""}`,topRight:e&&(p("edit_recurring_invoice")||h(e))?i(X,{label:o("more_actions"),resource:e,actions:f}):null,withoutActionContainer:!0,children:s(ee,{tabs:[o("overview"),o("history"),o("schedule"),o("activity")],width:"full",children:[s("div",{className:"space-y-2",children:[s("div",{children:[i(b,{leftSide:o("invoice_amount"),children:e?u((e==null?void 0:e.amount)||0,(S=e.client)==null?void 0:S.country_id,(w=e.client)==null?void 0:w.settings.currency_id):null}),i(b,{leftSide:o("balance_due"),children:e?u(e.balance||0,(g=e.client)==null?void 0:g.country_id,(x=e.client)==null?void 0:x.settings.currency_id):null}),e&&e.next_send_date?i(b,{leftSide:o("next_send_date"),children:e?m(e.next_send_datetime):null}):null,i(b,{leftSide:o("frequency"),children:o(ie[e==null?void 0:e.frequency_id])}),i(b,{leftSide:o("remaining_cycles"),withoutWrappingLeftSide:!0,children:(e==null?void 0:e.remaining_cycles)===-1?o("endless"):e==null?void 0:e.remaining_cycles}),i(b,{leftSide:o("auto_bill"),children:o((e==null?void 0:e.auto_bill)||"")}),i(b,{leftSide:o("status"),children:e?i(te,{entity:e}):null})]}),i(ne,{withoutPadding:!0}),s(oe,{className:"w-full",children:[i(D,{className:"text-center",onClick:()=>e?re(e):null,children:s("div",{className:"inline-flex items-center space-x-1",children:[i(y,{element:Ee}),i("p",{children:o("view_portal")})]})}),e?i(D,{className:"text-center",onClick:()=>{navigator.clipboard.writeText(se(e)??""),L.success("copied_to_clipboard",{value:""})},children:s("div",{className:"inline-flex items-center space-x-1",children:[i(y,{element:Pe}),i("p",{children:o("copy_link")})]})}):null]})]}),s("div",{children:[(t==null?void 0:t.activities)&&t.activities.length===0&&i($,{children:o("nothing_to_see_here")}),(t==null?void 0:t.activities)&&t.activities.map(r=>{var C,B,q;return i(D,{to:F("/activities/:id",{id:r.id}),children:s("div",{className:"flex flex-col",children:[s("div",{className:"flex space-x-1",children:[i("span",{children:e!=null&&e.client?u(r.history.amount||0,(C=e==null?void 0:e.client)==null?void 0:C.country_id,(B=e==null?void 0:e.client)==null?void 0:B.settings.currency_id):null}),i("span",{children:"·"}),i(le,{to:`/clients/${r.client_id}`,renderSpan:d("client",e==null?void 0:e.client),children:(q=e==null?void 0:e.client)==null?void 0:q.display_name})]}),s("div",{className:"inline-flex items-center space-x-1",children:[i("p",{children:k(r.created_at,`${v} h:mm:ss A`)}),i("p",{children:K.unix(r.created_at).fromNow()})]})]})},r.id)})]}),s("div",{children:[s("div",{className:"flex px-6 pt-2 pb-3 font-medium text-sm",children:[i("span",{className:"w-1/2",children:o("send_date")}),i("span",{className:"w-1/2",children:o("due_date")})]}),t==null?void 0:t.recurring_dates.map((r,C)=>s("div",{className:"flex px-6 py-2 text-sm",children:[i("span",{className:"w-1/2",children:k(r.send_date,v)}),i("span",{className:"w-1/2",children:k(r.due_date,v)})]},C))]}),i("div",{children:n==null?void 0:n.map(r=>s($,{className:"flex flex-col",children:[i("p",{children:a(r)}),s("div",{className:"inline-flex items-center space-x-1",children:[i("p",{children:k(r.created_at,`${v} h:mm:ss A`)}),i("p",{children:"·"}),i("p",{children:r.ip})]})]},r.id))})]})})},Ve=()=>{const[c]=N(),l=ce(),e=ue(),_=t=>t.flatMap(({documents:n})=>n.map(({id:a})=>a)),o=t=>t.some(({documents:n})=>n.length),m=t=>t.some(({is_deleted:n})=>!n),p=t=>t.some(({is_deleted:n})=>!n),h=t=>t.some(({is_deleted:n})=>!n),d=t=>t.every(({status_id:n})=>n===E.DRAFT||n===E.PAUSED),u=t=>t.every(({status_id:n})=>n===E.ACTIVE),f=(t,n)=>{const a=_(t);e(a,"download"),n([])};return[({selectedIds:t,selectedResources:n,setSelected:a})=>n&&d(n)&&i(T,{onClick:()=>{l(t,"start"),a([])},icon:i(y,{element:Re}),children:c("start")}),({selectedIds:t,selectedResources:n,setSelected:a})=>n&&u(n)&&i(T,{onClick:()=>{l(t,"stop"),a([])},icon:i(y,{element:Fe}),children:c("stop")}),({selectedIds:t,selectedResources:n,setSelected:a})=>n&&p(n)&&i(me,{selectedIds:t,setSelected:a}),({selectedIds:t,selectedResources:n,setSelected:a})=>n&&h(n)&&i(de,{selectedIds:t,setSelected:a}),({selectedResources:t,setSelected:n})=>t&&m(t)&&i(T,{onClick:()=>o(t)?f(t,n):L.error("no_documents_to_download"),icon:i(y,{element:Be}),children:c("documents")})]};function Mt(){pe("recurring_invoices");const[c]=N(),l=j(),e=O(),[_,o]=R.useState(""),{data:m}=he({id:_}),p=[{name:c("recurring_invoices"),href:"/recurring_invoices"}],h=U(),d=_e(),u=fe(),f=ve(),v=Ve(),{footerColumns:t,allFooterColumns:n}=Ie(),a=be(),[S,w]=A(z),[g,x]=A(H);return R.useEffect(()=>{m&&g&&w(m)},[m,g]),R.useEffect(()=>()=>x(!1),[]),s(ge,{title:c("recurring_invoices"),breadcrumbs:p,docsLink:"en/recurring-invoices/",withoutBackButton:!0,children:[i(xe,{resource:"recurring_invoice",columns:f,footerColumns:t,endpoint:"/api/v1/recurring_invoices?include=client&without_deleted_clients=true&sort=id|desc",linkToCreate:"/recurring_invoices/create",linkToEdit:"/recurring_invoices/:id/edit",bulkRoute:"/api/v1/recurring_invoices/bulk",customActions:h,customFilters:u,customBulkActions:v,customFilterPlaceholder:"status",withResourcefulActions:!0,rightSide:i(ye,{type:"component",guards:[Se(P("create_recurring_invoice"),P("edit_recurring_invoice"))],component:i(ke,{route:"/recurring_invoices/import"})}),leftSideChevrons:s("div",{className:Ne("flex items-center space-x-1",{"pr-4":!!d.show_table_footer}),children:[!!d.show_table_footer&&s(we,{children:[i(Me,{table:"recurringInvoice",columns:n}),i("span",{children:"|"})]}),i(Ae,{columns:a,defaultColumns:Ce,table:"recurringInvoice"})]}),linkToCreateGuards:[P("create_recurring_invoice")],hideEditableOptions:!l("edit_recurring_invoice"),onTableRowClick:r=>{o(r.id),x(!0)}}),!e("recurring_invoice",S)&&i(Ge,{})]})}export{Mt as default};
