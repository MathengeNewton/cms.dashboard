import{bD as R,b as $,u as P,A as D,E as G,r as L,e as O,a as e,R as z,j as a,T as H,G as C,cv as q,cw as K,cx as M,cy as Q,H as J,J as U,g as F,cz as X,cA as Y,N as Z,y as W,z as A,d as x,v as tt,c as et,bC as st,bB as it,ct as ot,bE as rt,cB as at,X as nt,x as lt,f as mt,Y as ct,Z as pt,_ as y,cu as ut,I as dt,$ as ht}from"./index-e5ac1c37.js";import"./classnames-eea0979a.js";import{r as v}from"./react-e483b31d.js";import"./react-debounce-input-20b6d49d.js";import"./react-redux-7b717b6c.js";import{aj as kt}from"./react-icons-071f44cd.js";import{D as ft}from"./DataTableColumnsPicker-e6b5c621.js";import{u as bt}from"./useShowEditOption-82c19b1f.js";import{I as Tt}from"./ImportButton-1d04ed88.js";import{S as gt}from"./Slider-3903b35c.js";import{a as _t}from"./react-query-557fee5a.js";import{bn as St,bx as Ct}from"./dayjs-75976aa4.js";import{r as At}from"./react-string-replace-e94ae631.js";import{u as Et}from"./hooks-b5be795e.js";import{T as wt}from"./TaskClock-0c5dcbf9.js";import{u as B}from"./react-i18next-91d47f13.js";import{b as N,u as E}from"./jotai-4279821d.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./lodash-bd2b80f6.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./@azure-485fd2d4.js";import"./react-router-82cc6afb.js";import"./@remix-run-dd360fb4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./react-router-dom-67fe6288.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./lodash.debounce-ddb7250b.js";const j=N(null),I=N(!1);St.extend(Ct);function xt(){const[i]=B();return s=>{var m,c,p,u,t,d,l;let r=W(`activity_${s.activity_type_id}`,{});const h={client:e(A,{to:x("/clients/:id",{id:(m=s.client)==null?void 0:m.hashed_id}),children:(c=s.client)==null?void 0:c.label}),user:((p=s.user)==null?void 0:p.label)??i("system"),task:e(A,{to:x("/tasks/:id/edit",{id:(u=s.task)==null?void 0:u.hashed_id}),children:(t=s==null?void 0:s.task)==null?void 0:t.label})??"",contact:e(A,{to:x("/clients/:id/edit",{id:(d=s==null?void 0:s.contact)==null?void 0:d.hashed_id}),children:(l=s==null?void 0:s.contact)==null?void 0:l.label})??""};for(const[k,n]of Object.entries(h))r=At(r,`:${k}`,()=>n);return r}}function yt(){var S,b;const[i]=B(),s=R({showCommonBulkAction:!0,showEditAction:!0}),{dateFormat:r}=$(),h=P(),m=Et(),c=D(),p=G(),u=xt(),[t,d]=E(j),[l,k]=E(I),n=t&&m(t.time_log),{data:f}=_t({queryKey:["/api/v1/activities",t==null?void 0:t.id,"task"],queryFn:()=>L("POST",O("/api/v1/activities/entity"),{entity:"task",entity_id:t==null?void 0:t.id}).then(o=>o.data.data),enabled:t!==null&&l,staleTime:1/0});return e(gt,{size:"regular",visible:l,onClose:()=>{k(!1),d(null)},title:`${i("task")} ${t==null?void 0:t.number}`,topRight:t&&(c("edit_task")||p(t))&&e(z,{label:i("more_actions"),resource:t,actions:s}),withoutActionContainer:!0,children:a(H,{tabs:[i("overview"),i("activity")],width:"full",children:[a("div",{className:"space-y-2",children:[a("div",{children:[e(C,{leftSide:i("amount"),children:t?h(t.rate*q(t.time_log),(S=t.client)==null?void 0:S.country_id,(b=t.client)==null?void 0:b.settings.currency_id):null}),e(C,{leftSide:i("entity_state"),children:t?i(K(t)):null}),e(C,{leftSide:i("duration"),children:t?M(t.time_log.toString(),!0):null}),e(C,{leftSide:i("status"),children:t?e(Q,{entity:t}):null})]}),e(J,{withoutPadding:!0}),t&&(n==null?void 0:n.map(([o,T,w],g)=>e(U,{children:a("div",{className:"flex items-center justify-between",children:[a("div",{className:"flex flex-col",children:[e("p",{children:F(o,r)}),a("small",{children:[T," - ",w]})]}),e("div",{children:X(t)&&g===n.length-1?e(wt,{task:t,calculateLastTimeLog:!0}):Y(t.time_log,g)})]})},g)))]}),e("div",{children:f==null?void 0:f.map(o=>a(Z,{className:"flex flex-col",children:[e("p",{children:u(o)}),a("div",{className:"inline-flex items-center space-x-1",children:[e("p",{children:F(o.created_at,`${r} h:mm:ss A`)}),e("p",{children:"Â·"}),e("p",{children:o.ip})]})]},o.id))})]})})}function Es(){const{documentTitle:i}=tt("tasks"),[s]=B(),r=D(),h=bt(),m=et(),c=[{name:s("tasks"),href:"/tasks"}],p=R(),u=st(),t=it(),d=ot(),l=rt(),[k,n]=v.useState(""),[f,S]=E(j),[b,o]=E(I),{data:T}=at({id:k});v.useEffect(()=>{T&&b&&S(T)},[T,b]),v.useEffect(()=>()=>o(!1),[]);const{changeTemplateVisible:w,setChangeTemplateVisible:g,changeTemplateResources:V}=nt();return a(lt,{title:i,breadcrumbs:c,withoutBackButton:!0,children:[e(mt,{resource:"task",columns:t,customActions:p,endpoint:"/api/v1/tasks?include=status,client,project,user,assigned_user&without_deleted_clients=true&sort=id|desc",bulkRoute:"/api/v1/tasks/bulk",linkToCreate:"/tasks/create",linkToEdit:"/tasks/:id/edit",showEdit:_=>h(_),customFilters:u,customBulkActions:l,customFilterPlaceholder:"status",withResourcefulActions:!0,rightSide:e(ct,{type:"component",component:e(Tt,{route:"/tasks/import"}),guards:[pt(y("create_task"),y("edit_task"))]}),leftSideChevrons:e(ft,{columns:d,defaultColumns:ut,table:"task"}),beforeFilter:(r("view_task")||r("edit_task"))&&e(A,{to:"/tasks/kanban",children:a(dt,{children:[e(kt,{size:20}),e("span",{children:"Kanban"})]})}),linkToCreateGuards:[y("create_task")],hideEditableOptions:!r("edit_task"),onTableRowClick:_=>{n(_.id),o(!0)}}),!m("task",f)&&e(yt,{}),e(ht,{entity:"task",entities:V,visible:w,setVisible:g,labelFn:_=>`${s("number")}: ${_.number}`,bulkUrl:"/api/v1/tasks/bulk"})]})}export{Es as default};
