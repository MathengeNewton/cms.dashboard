import{at as E,Q as y,r as P,e as x,ao as D,A as N,ah as J,a4 as W,a6 as Z,a5 as ee,a7 as te,j as O,F as ne,a as i,a2 as p,O as f,a3 as ie,a8 as T,aP as ae,h as se,aw as B,av as $,d as S,a9 as oe,a1 as ce,aa as le,ac as de,ad as re,ab as ue,X as me,ai as z,b as _e,c as pe,u as fe,l as he,aj as ve,ak as ge,D as Q,g as M,al as ye,am as Ce,U as j,a0 as K,bz as be,aS as Ie,aB as Me,aQ as ke,aR as Se,ax as X,af as Pe,ag as xe,K as De,H as q}from"./index-e5ac1c37.js";import{C as Te,a as w}from"./CreditStatus-a8db5dbf.js";import{r as U}from"./useInvoiceColumns-1c3431ff.js";import{u as R}from"./react-query-557fee5a.js";import{d as Y,c as k,u as V}from"./jotai-4279821d.js";import{K as G,k as we,O as Ae,P as Ee,I as H,Q as Re,N as Ye,U as Fe,af as Le,R as Oe,a6 as Qe,V as je,s as qe,u as Ue,t as Ve}from"./react-icons-071f44cd.js";import{bn as A}from"./dayjs-75976aa4.js";import{r as He}from"./react-e483b31d.js";import{u as F}from"./react-i18next-91d47f13.js";import{a as L}from"./react-router-82cc6afb.js";import{i as Ne,k as Be,R as $e}from"./react-feather-90dbe0b6.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function ze(){const n=R(),o=Y(E);return l=>{y.processing(),P("PUT",x("/api/v1/credits/:id?mark_sent=true",{id:l.id}),l).then(()=>{o&&n.invalidateQueries([o]),D(["credits"]),y.success("updated_credit")})}}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function Ke(){const n=R(),o=Y(E);return l=>{y.processing(),P("PUT",x("/api/v1/credits/:id?mark_paid=true",{id:l.id}),l).then(()=>{o&&n.invalidateQueries([o]),D(["credits"]),y.success("updated_credit")})}}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */const Xe={email:"emailed_credits",mark_sent:"marked_credit_as_sent"},Ge=()=>{const n=R(),o=Y(E);return(l,c)=>{y.processing(),P("POST",x("/api/v1/credits/bulk"),{action:c,ids:l}).then(()=>{const r=Xe[c]||`${c}d_credit`;y.success(r),D(["credits"]),o&&n.invalidateQueries([o])})}};function Je(n){const[o]=F(),l=L(),{credit:c}=n,r=N(),v=k(J),h=k(W),C=k(Z),g=k(ee),m=te(),[_,b]=He.useState(!1),I=()=>{v({...c,id:"",number:"",documents:[],due_date:"",date:A().format("YYYY-MM-DD"),total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",paid_to_date:0,po_number:"",design_id:m.settings.invoice_design_id}),l("/invoices/create?action=clone")},u=()=>{h({...c,id:"",number:"",documents:[],date:A().format("YYYY-MM-DD"),due_date:"",total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",paid_to_date:0,po_number:"",design_id:m.settings.quote_design_id}),l("/quotes/create?action=clone")},t=()=>{C({...c,id:"",number:"",documents:[],frequency_id:"5",paid_to_date:0,total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",po_number:"",design_id:m.settings.invoice_design_id}),l("/recurring_invoices/create?action=clone")},e=()=>{g({...c,id:"",number:"",documents:[],date:A().format("YYYY-MM-DD"),total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"1",vendor_id:"",po_number:"",design_id:m.settings.purchase_order_design_id}),l("/purchase_orders/create?action=clone")};return O(ne,{children:[(r("create_invoice")||r("create_quote")||r("create_recurring_invoice")||r("create_purchase_order"))&&i(p,{onClick:()=>b(!0),icon:i(f,{element:G}),children:o("clone_to_other")}),i(ie,{title:o("clone_to"),visible:_,onClose:()=>b(!1),closeButtonCypressRef:"cloneOptionsModalXButton",children:i("div",{className:"flex justify-center",children:O("div",{className:"flex flex-1 flex-col items-center space-y-3",children:[r("create_invoice")&&i(T,{label:o("invoice"),icon:Ne,onClick:I}),r("create_quote")&&i(T,{label:o("quote"),icon:Be,onClick:u}),r("create_recurring_invoice")&&i(T,{label:o("recurring_invoice"),icon:$e,onClick:t}),r("create_purchase_order")&&i(T,{label:o("purchase_order"),icon:we,onClick:e})]})})})]})}function ut(n){const o=ae(),l=se(),[c,r]=V(K),[,v]=V(be),h=(u,t)=>{r(e=>e&&{...e,[u]:t})};return{handleChange:h,handleInvitationChange:(u,t)=>{let e=[...c.invitations];const s=(e==null?void 0:e.find(d=>d.client_contact_id===u))||-1;if(s!==-1&&t===!1&&(e=e.filter(d=>d.client_contact_id!==u)),s===-1){const d={client_contact_id:u};e.push(d)}h("invitations",e)},handleLineItemChange:(u,t)=>{const e=(c==null?void 0:c.line_items)||[];e[u]=t,r(s=>s&&{...s,line_items:e})},handleLineItemPropertyChange:(u,t,e)=>{const s=(c==null?void 0:c.line_items)||[];s[e][u]=t,r(d=>d&&{...d,line_items:s})},handleCreateLineItem:()=>{r(u=>u&&{...u,line_items:[...u.line_items,{...Ie(),type_id:Me.Product}]})},handleDeleteLineItem:u=>{const t=(c==null?void 0:c.line_items)||[];t.splice(u,1),r(e=>e&&{...e,line_items:t})},calculateInvoiceSum:u=>{var e;const t=o(((e=n.client)==null?void 0:e.settings.currency_id)||(l==null?void 0:l.settings.currency_id));if(t&&u){const s=u.uses_inclusive_taxes?new ke(u,t).build():new Se(u,t).build();v(s)}}}}function mt(n){const{setErrors:o,isDefaultFooter:l,isDefaultTerms:c}=n,r=L(),v=B(),h=$(),C=k(X);return async g=>{y.processing(),o(void 0),await v(!0);let m="/api/v1/credits?";c?(m+="save_default_terms=true",l&&(m+="&save_default_footer=true")):l&&(m+="save_default_footer=true"),P("POST",x(m),g).then(async _=>{(c||l)&&await h(),y.success("created_credit"),D(["credits"]),r(S("/credits/:id/edit",{id:_.data.data.id}))}).catch(_=>{var b;((b=_.response)==null?void 0:b.status)===422&&(y.dismiss(),o(_.response.data),_.response.data.errors.invoice_id&&y.error(_.response.data.errors.invoice_id[0]))}).finally(()=>C(void 0))}}function _t(n){const{setErrors:o,isDefaultFooter:l,isDefaultTerms:c}=n,r=k(X),v=$(),h=B();return async C=>{y.processing(),o(void 0),await h(!0);let g="/api/v1/credits/:id?";c?(g+="save_default_terms=true",l&&(g+="&save_default_footer=true")):l&&(g+="save_default_footer=true"),P("PUT",x(g,{id:C.id}),C).then(async()=>{(c||l)&&await v(),y.success("updated_credit"),D(["credits"])}).catch(m=>{var _;((_=m.response)==null?void 0:_.status)===422&&(o(m.response.data),y.dismiss())}).finally(()=>r(void 0))}}function pt(){const[n]=F(),o=L(),l=N(),{isAdmin:c,isOwner:r}=oe(),{isEditPage:v}=ce({entity:"credit"}),h=k(K),C=le({resource:"credit"}),g=de({entity:"credit"}),m=ze(),_=Ke(),b=Ge(),I=re({entity:"credit"}),u=ue({resource:"credit",downloadType:"download_e_credit"}),t=a=>{h({...a,id:"",number:"",documents:[],date:A().format("YYYY-MM-DD"),due_date:"",total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",paid_to_date:0,po_number:""}),o("/credits/create?action=clone")},{setChangeTemplateResources:e,setChangeTemplateVisible:s}=me();return[a=>i(p,{to:S("/credits/:id/pdf",{id:a.id}),icon:i(f,{element:Ae}),children:n("view_pdf")}),a=>Pe(a)!==xe.Deleted&&i(p,{onClick:()=>g([a.id]),icon:i(f,{element:Ee}),children:n("print_pdf")}),a=>i(p,{onClick:()=>C(a),icon:i(f,{element:H}),children:n("download_pdf")}),a=>i(p,{onClick:()=>u(a),icon:i(f,{element:H}),children:n("download_e_credit")}),a=>(c||r)&&i(p,{onClick:()=>I(a.id),icon:i(f,{element:Re}),children:n("schedule")}),a=>i(p,{to:S("/credits/:id/email",{id:a.id}),icon:i(f,{element:Ye}),children:n("email_credit")}),a=>i(p,{onClick:()=>a&&De(a),icon:i(f,{element:Fe}),children:n("client_portal")}),a=>a.client_id&&a.amount>0&&l("create_payment")&&i(p,{to:S("/payments/create?client=:clientId&credit=:creditId&type=1",{clientId:a.client_id,creditId:a.id}),icon:i(f,{element:Le}),children:n("apply_credit")}),a=>a.status_id===w.Draft&&i("div",{children:i(p,{onClick:()=>m(a),icon:i(f,{element:Oe}),children:n("mark_sent")})}),a=>(a.status_id===w.Draft||a.status_id===w.Sent||a.status_id===w.Partial)&&a.amount<0&&i("div",{children:i(p,{onClick:()=>_(a),icon:i(f,{element:Qe}),children:n("mark_paid")})}),a=>i(p,{onClick:()=>{s(!0),e([a])},icon:i(f,{element:je}),children:n("run_template")}),()=>i(q,{withoutPadding:!0}),a=>l("create_credit")&&i(p,{onClick:()=>t(a),icon:i(f,{element:G}),children:n("clone_to_credit")}),a=>i(Je,{credit:a}),()=>v&&i(q,{withoutPadding:!0}),a=>v&&a.archived_at===0&&i(p,{onClick:()=>b([a.id],"archive"),icon:i(f,{element:qe}),children:n("archive")}),a=>v&&a.archived_at>0&&i(p,{onClick:()=>b([a.id],"restore"),icon:i(f,{element:Ue}),children:n("restore")}),a=>v&&!(a!=null&&a.is_deleted)&&i(p,{onClick:()=>b([a.id],"delete"),icon:i(f,{element:Ve}),children:n("delete")})]}const We=["status","number","client","amount","date","remaining"];function Ze(){const[n,o,l,c]=z({entity:"invoice"});return["status","number","client","amount","date","remaining","archived_at","client_city","client_country","client_postal_code","client_state","contact_email","contact_name","created_at",n,o,l,c,"discount","documents","entity_state","exchange_rate","is_deleted","is_viewed","last_sent_date","partial","partial_due_date","po_number","private_notes","public_notes","tax_amount","updated_at","valid_until"]}function ft(){var u;const{t:n}=F(),{dateFormat:o}=_e(),l=pe();Ze();const c=fe(),r=he(),v=ve(),h=ge(),[C,g,m,_]=z({entity:"invoice"}),b=[{column:"status",id:"status_id",label:n("status"),format:(t,e)=>i(Te,{entity:e})},{column:"number",id:"number",label:n("number"),format:(t,e)=>i(Q,{to:S("/credits/:id/edit",{id:e.id}),renderSpan:l("credit",e),children:t})},{column:"client",id:"client_id",label:n("client"),format:(t,e)=>{var s;return i(Q,{to:S("/clients/:id",{id:e.client_id}),renderSpan:l("client",e.client),children:(s=e.client)==null?void 0:s.display_name})}},{column:"amount",id:"amount",label:n("amount"),format:(t,e)=>{var s,d;return c(t,(s=e.client)==null?void 0:s.country_id,(d=e.client)==null?void 0:d.settings.currency_id)}},{column:"date",id:"date",label:n("date"),format:t=>M(t,o)},{column:"remaining",id:"balance",label:n("remaining"),format:(t,e)=>{var s,d;return c(e.balance,(s=e.client)==null?void 0:s.country_id,(d=e.client)==null?void 0:d.settings.currency_id)}},{column:"archived_at",id:"archived_at",label:n("archived_at"),format:t=>M(t,o)},{column:"client_city",id:"client_id",label:n("client_city"),format:(t,e)=>{var s;return(s=e.client)==null?void 0:s.city}},{column:"client_country",id:"client_id",label:n("client_country"),format:(t,e)=>{var s,d,a;return((s=e.client)==null?void 0:s.country_id)&&((a=v((d=e.client)==null?void 0:d.country_id))==null?void 0:a.name)}},{column:"client_postal_code",id:"client_id",label:n("client_postal_code"),format:(t,e)=>{var s;return(s=e.client)==null?void 0:s.postal_code}},{column:"client_state",id:"client_id",label:n("client_state"),format:(t,e)=>{var s;return(s=e.client)==null?void 0:s.state}},{column:"contact_email",id:"client_id",label:n("contact_email"),format:(t,e)=>{var s;return e.client&&e.client.contacts.length>0&&i(ye,{text:(s=e.client)==null?void 0:s.contacts[0].email})}},{column:"contact_name",id:"client_id",label:n("contact_name"),format:(t,e)=>{var s,d;return e.client&&e.client.contacts.length>0&&`${(s=e.client)==null?void 0:s.contacts[0].first_name} ${(d=e.client)==null?void 0:d.contacts[0].last_name}`}},{column:"created_at",id:"created_at",label:n("created_at"),format:t=>M(t,o)},{column:C,id:"custom_value1",label:C,format:t=>h("invoice1",t==null?void 0:t.toString())},{column:g,id:"custom_value2",label:g,format:t=>h("invoice2",t==null?void 0:t.toString())},{column:m,id:"custom_value3",label:m,format:t=>h("invoice3",t==null?void 0:t.toString())},{column:_,id:"custom_value4",label:_,format:t=>h("invoice4",t==null?void 0:t.toString())},{column:"discount",id:"discount",label:n("discount"),format:(t,e)=>{var s,d;return c(t,(s=e.client)==null?void 0:s.country_id,(d=e.client)==null?void 0:d.settings.currency_id)}},{column:"documents",id:"documents",label:n("documents"),format:(t,e)=>e.documents.length},{column:"entity_state",id:"id",label:n("entity_state"),format:(t,e)=>i(Ce,{entity:e})},{column:"exchange_rate",id:"exchange_rate",label:n("exchange_rate")},{column:"is_deleted",id:"is_deleted",label:n("is_deleted"),format:(t,e)=>e.is_deleted?n("yes"):n("no")},{column:"is_viewed",id:"id",label:n("is_viewed"),format:(t,e)=>U(e).length>0?M(U(e),o):n("no")},{column:"last_sent_date",id:"last_sent_date",label:n("last_sent_date"),format:t=>M(t,o)},{column:"partial",id:"partial",label:n("partial"),format:(t,e)=>{var s,d;return c(t,(s=e.client)==null?void 0:s.country_id,(d=e.client)==null?void 0:d.settings.currency_id)}},{column:"partial_due_date",id:"partial_due_date",label:n("partial_due_date"),format:t=>M(t,o)},{column:"po_number",id:"po_number",label:n("po_number")},{column:"private_notes",id:"private_notes",label:n("private_notes"),format:t=>i(j,{size:"regular",truncate:!0,containsUnsafeHTMLTags:!0,message:t,children:i("span",{dangerouslySetInnerHTML:{__html:t.slice(0,50)}})})},{column:"public_notes",id:"public_notes",label:n("public_notes"),format:t=>i(j,{size:"regular",truncate:!0,containsUnsafeHTMLTags:!0,message:t,children:i("span",{dangerouslySetInnerHTML:{__html:t.slice(0,50)}})})},{column:"tax_amount",id:"total_taxes",label:n("total_taxes"),format:(t,e)=>{var s,d;return c(t,(s=e.client)==null?void 0:s.country_id,(d=e.client)==null?void 0:d.settings.currency_id)}},{column:"updated_at",id:"updated_at",label:n("updated_at"),format:t=>M(t,o)},{column:"valid_until",id:"id",label:n("valid_until"),format:(t,e)=>M(e.due_date,o)}],I=((u=r==null?void 0:r.react_table_columns)==null?void 0:u.credit)||We;return b.filter(t=>I.includes(t.column)).sort((t,e)=>I.indexOf(t.column)-I.indexOf(e.column))}export{pt as a,Ge as b,Ze as c,We as d,ut as e,mt as f,_t as g,ft as u};
