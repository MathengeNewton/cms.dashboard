import{av as te,aw as ie,Q as U,r as z,e as q,ao as Q,ax as se,n as G,a as i,a3 as oe,j as u,b0 as ae,O as D,p as ne,ap as re,F as ce,A as le,E as me,l as pe,d as de,v as ue,V as fe,X as he,x as ve,R as ge,C as Ce,T as ye,aA as V,aB as x,S as B,$ as be,ah as _e,aC as Ie}from"./index-ecbcc3c7.js";import{I as Se}from"./invoice-status-756326ba.js";import{y as N}from"./lodash-bd2b80f6.js";import{r as m}from"./react-e483b31d.js";import{u as xe}from"./react-router-dom-67fe6288.js";import{C as Te}from"./ClientSelector-8b233044.js";import{u as Ae,I as ke,a as De}from"./useInvoiceUtilities-d2c4c44c.js";import{u as Ne,I as we,a as Ee}from"./useProductColumns-62bcf2b6.js";import{u as Pe}from"./useTaskColumns-fe4d1c28.js";import{b as Re,u as W}from"./Actions-bf5a7e5b.js";import{c as Le,u as H}from"./jotai-c7720f6e.js";import"./classnames-eea0979a.js";import{I as Ue}from"./InvoiceStatus-e10dbdfb.js";import"./react-debounce-input-20b6d49d.js";import{a as Fe}from"./react-redux-7b717b6c.js";import{o as O,v as j,a3 as Me}from"./react-icons-071f44cd.js";import{D as $e,C as Ve,P as Be}from"./@hello-pangea-bfa72c9a.js";import{a as He}from"./array-move-3ca81c74.js";import{u as X}from"./react-i18next-91d47f13.js";import{e as Oe}from"./react-router-82cc6afb.js";import{v as je}from"./uuid-4a60fe23.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./dayjs-75976aa4.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./react-query-557fee5a.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@azure-485fd2d4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./react-string-replace-e94ae631.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./@remix-run-dd360fb4.js";import"./lodash.debounce-ddb7250b.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./ProjectSelector-0c0e158e.js";import"./DesignSelector-1def70e7.js";import"./designs-863b1b5c.js";import"./InvoiceViewer-a729b03c.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function ze(f){const{setErrors:r,isDefaultTerms:n,isDefaultFooter:d}=f,S=te(),s=ie(),h=Le(se);return async _=>{r(void 0),U.processing(),await s(!0);let l="/api/v1/invoices/:id?";n?(l+="save_default_terms=true",d&&(l+="&save_default_footer=true")):d&&(l+="save_default_footer=true"),z("PUT",q(l,{id:_.id}),_).then(async()=>{(n||d)&&await S(),U.success("updated_invoice"),Q(["products","invoices"])}).catch(a=>{var C;((C=a.response)==null?void 0:C.status)===422&&(r(a.response.data),U.dismiss())}).finally(()=>h(void 0))}}function qe(f){var k,E;const[r]=X(),n=G(),d=Fe(),S=Re(),[s,h]=m.useState((E=(k=n==null?void 0:n.company_user)==null?void 0:k.react_settings)==null?void 0:E.common_actions),[_,l]=m.useState([]),{entity:a,visible:C,setVisible:t}=f,I=S[a],[y,v]=m.useState(""),T=()=>{var e;return N.isEqual((e=n==null?void 0:n.company_user)==null?void 0:e.react_settings.common_actions,s)},g=e=>{var o;return((o=I.find(({value:c})=>c===e))==null?void 0:o.label)||""},R=()=>{const e=N.cloneDeep(n);N.set(e,"company_user.react_settings.common_actions",s),z("PUT",q("/api/v1/company_users/:id",{id:e.id}),e).then(o=>{N.set(e,"company_user",o.data.data),Q(["company_users"]),d(re(e))})},w=e=>{const o=s==null?void 0:s[a].filter(c=>e!==c);o&&h(c=>c&&{...c,[a]:o})},L=e=>{var c;const o=He(s==null?void 0:s[a],e.source.index,(c=e.destination)==null?void 0:c.index);h(b=>b&&{...b,[a]:o})};return m.useEffect(()=>{if(y){const e=I.find(({value:o})=>y===o);e&&h(o=>o?{...o,[a]:[...o[a],e.value]}:{[a]:[e.value]}),v("")}},[y]),m.useEffect(()=>{s&&s[a]?l(I.filter(({value:e})=>!s[a].some(o=>o===e))):l(I)},[s]),i(oe,{title:`${r(`${a}s`)} ${r("actions")} ${r("preferences")}`,visible:C,onClose:()=>{var e;t(!1),h((e=n==null?void 0:n.company_user)==null?void 0:e.react_settings.common_actions)},overflowVisible:!0,children:u("div",{className:"flex flex-col space-y-4",children:[i(ae,{value:y,onValueChange:e=>v(e),label:r("actions"),clearAfterSelection:!0,children:_.map(({label:e,value:o})=>i("option",{value:o,children:e},o))}),!!(s!=null&&s[a].length)&&u("span",{className:"font-medium",children:[r("selected")," ",r("actions"),":"]}),!!(s!=null&&s[a].length)&&i($e,{onDragEnd:L,children:i(Ve,{droppableId:"preference-actions",renderClone:(e,o,c)=>u("div",{className:"flex items-center justify-between text-sm",...e.draggableProps,...e.dragHandleProps,ref:e.innerRef,children:[u("div",{className:"flex items-center space-x-2",children:[i(D,{className:"cursor-pointer",element:O,size:25}),i("span",{className:"font-medium",children:g(s==null?void 0:s[a][c.source.index])})]}),i("div",{children:i(D,{className:"cursor-pointer",element:j,size:25})})]}),children:e=>u("div",{className:"flex flex-col",...e.droppableProps,ref:e.innerRef,children:[s==null?void 0:s[a].map((o,c)=>i(Be,{draggableId:c.toString(),index:c,children:b=>m.createElement("div",{className:"flex items-center justify-between py-1.5",...b.draggableProps,ref:b.innerRef,key:c},u("div",{className:"flex items-center space-x-2",children:[i(D,{className:"cursor-pointer",element:O,size:25,onClick:()=>w(o)}),i("span",{className:"font-medium",children:g(o)})]}),i("div",{...b.dragHandleProps,children:i(D,{className:"cursor-pointer",element:j,size:25})}))},c)),e.placeholder]})})}),i(ne,{onClick:()=>{R(),t(!1)},disabled:T(),disableWithoutIcon:!0,children:r("save")})]})})}function Qe(f){const r=G(),n=W({dropdown:!1}),{invoice:d}=f,[S,s]=m.useState(!1),[h,_]=m.useState();return m.useEffect(()=>{var a,C,t;const l=(t=(C=(a=r==null?void 0:r.company_user)==null?void 0:a.react_settings)==null?void 0:C.common_actions)==null?void 0:t.invoice;if(l){const I=n.filter(y=>{var v;return l.includes((v=y(d))==null?void 0:v.key)}).sort((y,v)=>{var T,g;return l.indexOf(String((T=y(d))==null?void 0:T.key)??"")-l.indexOf(String((g=v(d))==null?void 0:g.key)??"")});_(I)}},[r,d]),u(ce,{children:[u("div",{className:"flex items-center space-x-4",children:[h==null?void 0:h.map((l,a)=>i("div",{children:l(d)},a)),i("div",{children:i(D,{className:"cursor-pointer",element:Me,size:25,onClick:()=>s(!0)})})]}),i(qe,{entity:"invoice",visible:S,setVisible:s})]})}function Wi(){const{t:f}=X(),{id:r}=Oe(),[n]=xe(),d=le(),S=me(),s=pe(),h=[{name:f("invoices"),href:"/invoices"},{name:f("edit_invoice"),href:de("/invoices/:id/edit",{id:r})}],_=Ne(),l=Pe(),{documentTitle:a}=ue("edit_invoice"),{data:C}=fe({id:r}),[t,I]=H(_e),[y]=H(Ie),[v,T]=m.useState(),[g,R]=m.useState(),[w,L]=m.useState(!1),[k,E]=m.useState(!1),{handleChange:e,handleInvitationChange:o,calculateInvoiceSum:c,handleLineItemChange:b,handleLineItemPropertyChange:F,handleCreateLineItem:M,handleDeleteLineItem:$}=Ae({client:v});m.useEffect(()=>{const P=n.get("action")&&t?t:C;if(P){const A=N.cloneDeep(P);A.line_items.map(ee=>ee._id=je()),I(A),A!=null&&A.client&&T(A.client)}},[C]),m.useEffect(()=>{t&&c(t)},[t]);const J=W(),Y=ze({setErrors:R,isDefaultTerms:w,isDefaultFooter:k}),{changeTemplateVisible:Z,setChangeTemplateVisible:K}=he();return u(ve,{title:a,breadcrumbs:h,...(d("edit_invoice")||S(t))&&t&&{navigationTopRight:i(ge,{resource:t,actions:J,onSaveClick:()=>t&&Y(t),disableSaveButton:t&&(t.status_id===Se.Cancelled||t.is_deleted),cypressRef:"invoiceActionDropdown"}),topRight:i(Qe,{invoice:t})},children:[u("div",{className:"grid grid-cols-12 gap-4",children:[u(Ce,{className:"col-span-12 xl:col-span-4 h-max",withContainer:!0,children:[t&&u("div",{className:"flex space-x-20",children:[i("span",{className:"text-sm",children:f("status")}),i(Ue,{entity:t})]}),i(Te,{resource:t,onChange:p=>e("client_id",p),onClearButtonClick:()=>e("client_id",""),onContactCheckboxChange:o,errorMessage:g==null?void 0:g.errors.client_id,textOnly:!0,readonly:!0})]}),i(ke,{invoice:t,handleChange:e,errors:g}),i("div",{className:"col-span-12",children:u(ye,{tabs:[f("products"),f("tasks")],defaultTabIndex:n.get("table")==="tasks"?1:0,children:[i("div",{children:t&&v?i(V,{type:"product",resource:t,shouldCreateInitialLineItem:n.get("table")!=="tasks",items:t.line_items.filter(p=>[x.Product,x.UnpaidFee,x.PaidFee,x.LateFee].includes(p.type_id)),columns:_,relationType:"client_id",onLineItemChange:b,onSort:p=>e("line_items",p),onLineItemPropertyChange:F,onCreateItemClick:()=>M(x.Product),onDeleteRowClick:$}):i(B,{})}),i("div",{children:t&&v?i(V,{type:"task",resource:t,shouldCreateInitialLineItem:n.get("table")==="tasks",items:t.line_items.filter(p=>p.type_id===x.Task),columns:l,relationType:"client_id",onLineItemChange:b,onSort:p=>e("line_items",p),onLineItemPropertyChange:F,onCreateItemClick:()=>M(x.Task),onDeleteRowClick:$}):i(B,{})})]})}),i(De,{invoice:t,handleChange:e,errors:g,isDefaultFooter:k,isDefaultTerms:w,setIsDefaultFooter:E,setIsDefaultTerms:L}),t&&i(we,{relationType:"client_id",resource:t,invoiceSum:y,onChange:(p,P)=>e(p,P)})]}),(s==null?void 0:s.show_pdf_preview)&&i("div",{className:"my-4",children:t&&i(Ee,{for:"invoice",resource:t,entity:"invoice",relationType:"client_id",endpoint:"/api/v1/live_preview?entity=:entity",observable:!0,initiallyVisible:!1,withRemoveLogoCTA:!0})}),t?i(be,{entity:"invoice",entities:[t],visible:Z,setVisible:K,labelFn:p=>`${f("number")}: ${p.number}`,bulkUrl:"/api/v1/invoices/bulk"}):null]})}export{Wi as default};
