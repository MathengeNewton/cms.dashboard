import{v as R,h as V,l as j,b2 as A,dn as B,dp as O,j as v,x as M,a as n,C as Q,aA as q,S as z,F as G,a5 as J}from"./index-ecbcc3c7.js";import{y}from"./lodash-bd2b80f6.js";import{u as K,I as U,a as W}from"./useProductColumns-62bcf2b6.js";import{r as m}from"./react-e483b31d.js";import{u as X}from"./react-router-dom-67fe6288.js";import{u as Y,a as Z,V as $,D as ee,F as te,b as oe,c as re,d as ie}from"./useHandleProductChange-d94b6c35.js";import{b as ne}from"./blank-invitation-ca06b7b6.js";import"./classnames-eea0979a.js";import{u as se}from"./react-i18next-91d47f13.js";import{v as ae}from"./uuid-4a60fe23.js";import{u as me}from"./jotai-c7720f6e.js";import"./react-redux-7b717b6c.js";import"./react-dom-ce3e84ee.js";import"./@babel-e5cbf021.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-2fceee1f.js";import"./react-is-e8e5dbb3.js";import"./use-sync-external-store-7794fa59.js";import"./dayjs-75976aa4.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./react-query-557fee5a.js";import"./@azure-485fd2d4.js";import"./react-router-82cc6afb.js";import"./@remix-run-dd360fb4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-debounce-input-20b6d49d.js";import"./lodash.debounce-ddb7250b.js";import"./@headlessui-220c51a1.js";import"./react-icons-071f44cd.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./react-string-replace-e94ae631.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./InvoiceViewer-a729b03c.js";import"./DesignSelector-1def70e7.js";import"./designs-863b1b5c.js";import"./ProjectSelector-0c0e158e.js";function so(){const{documentTitle:I}=R("new_purchase_order"),{t:f}=se(),l=V(),u=j(),S=A(),[p]=X(),D=[{name:f("purchase_orders"),href:"/purchase_orders"},{name:f("new_purchase_order"),href:"/purchase_orders/create"}],[e,a]=me(J),{data:h}=B({enabled:typeof e>"u"});m.useEffect(()=>(a(t=>{var r;let o=t;if(p.get("action")!=="clone"&&p.get("action")!=="purchase_order_product"&&(o=void 0),typeof h<"u"&&typeof o>"u"&&p.get("action")!=="clone"){const i=y.cloneDeep(h);typeof i.line_items=="string"&&(i.line_items=[]),p.get("vendor")&&(i.vendor_id=p.get("vendor")),i.line_items.forEach(d=>d._id=ae()),i.invitations.forEach(d=>d.client_contact_id=d.client_contact_id||""),i.uses_inclusive_taxes=((r=l==null?void 0:l.settings)==null?void 0:r.inclusive_taxes)??!1,o=i}return o}),()=>{a(void 0)}),[h]);const[P,_]=m.useState(),[c,x]=m.useState(),[C,b]=m.useState(!1),[g,T]=m.useState(!1),w=K(),s=(t,o)=>{a(r=>r&&{...r,[t]:o})},L=oe(s),k=re(a),E=ie(a),F=Y(a,_),H=Z(a,_),N=O({setErrors:x,isDefaultTerms:C,isDefaultFooter:g});return m.useEffect(()=>{e&&e.vendor_id&&S.find(e.vendor_id).then(t=>{const o=[];t.contacts.map(r=>{if(r.send_email){const i=y.cloneDeep(ne);i.vendor_contact_id=r.id,o.push(i)}}),s("invitations",o)})},[e==null?void 0:e.vendor_id]),v(M,{title:I,breadcrumbs:D,onSaveClick:()=>e&&N(e),children:[v("div",{className:"grid grid-cols-12 gap-4",children:[n(Q,{className:"col-span-12 xl:col-span-4 h-max",withContainer:!0,children:n($,{resource:e,onChange:t=>s("vendor_id",t),onClearButtonClick:()=>s("vendor_id",""),onContactCheckboxChange:(t,o)=>e&&L(e,t,o),initiallyVisible:!0,errorMessage:c==null?void 0:c.errors.vendor_id})}),e&&n(ee,{purchaseOrder:e,handleChange:s,errors:c}),n("div",{className:"col-span-12",children:e?n(q,{type:"product",resource:e,items:e.line_items,columns:w,relationType:"vendor_id",onLineItemChange:(t,o)=>F(e,t,o),onSort:t=>s("line_items",t),onLineItemPropertyChange:(t,o,r)=>H(e,t,o,r),onCreateItemClick:()=>k(e),onDeleteRowClick:t=>E(e,t)}):n(z,{})}),e&&v(G,{children:[n(te,{purchaseOrder:e,handleChange:s,errors:c,isDefaultFooter:g,isDefaultTerms:C,setIsDefaultFooter:T,setIsDefaultTerms:b}),n(U,{relationType:"vendor_id",resource:e,invoiceSum:P,onChange:(t,o)=>s(t,o)})]})]}),(u==null?void 0:u.show_pdf_preview)&&n("div",{className:"my-4",children:e&&n(W,{for:"create",resource:e,entity:"purchase_order",relationType:"vendor_id",endpoint:"/api/v1/live_preview/purchase_order?entity=:entity"})})]})}export{so as default};
