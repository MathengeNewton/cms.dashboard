import{A as re,E as ne,h as le,bh as _e,u as $e,b as de,j as l,T as ce,a as e,aJ as ye,F as H,G as B,cx as me,cy as xe,N as Te,J as ue,g as pe,cz as P,cA as we,aL as Ie,e as Q,aM as Ne,ao as G,cC as Ee,a3 as he,aH as j,p as R,aD as De,aN as je,cE as Le,cF as Ve,Q as M,cG as Ae,r as be,v as Pe,a9 as Me,cH as Oe,cI as Be,cJ as Fe,cK as ze,d as oe,k as Ke,x as He,z as Re,I as Qe,C as Ge,cL as Je}from"./index-e5ac1c37.js";import"./classnames-eea0979a.js";import{r as f}from"./react-e483b31d.js";import"./react-debounce-input-20b6d49d.js";import"./react-redux-7b717b6c.js";import{ak as Ue,al as We,C as qe}from"./react-icons-071f44cd.js";import{c as Xe}from"./collect.js-ebd014c9.js";import{D as Ye,C as Ze,P as et}from"./@hello-pangea-bfa72c9a.js";import{y as tt}from"./lodash-bd2b80f6.js";import{a as st}from"./array-move-3ca81c74.js";import"./react-query-557fee5a.js";import"./i18next-076b76a4.js";import"./react-hot-toast-d3a0fddd.js";import"./dayjs-75976aa4.js";import{u as fe,c as J,a as ot,b as at,i as it}from"./hooks-b5be795e.js";import{T as ge}from"./TaskClock-0c5dcbf9.js";import{u as F}from"./react-i18next-91d47f13.js";import{u as O}from"./jotai-4279821d.js";import{S as rt}from"./Slider-3903b35c.js";import{P as ke}from"./ProjectSelector-c72052c6.js";import{p as ae,L as g,a as ie,d as nt,T as lt,h as dt,b as ct,c as mt,e as ut,f as pt}from"./TaskDetails-a53d4cf4.js";import{L as ht}from"./react-router-dom-67fe6288.js";import{K as bt,N as ft,O as gt}from"./react-feather-90dbe0b6.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./axios-60492c0c.js";import"./@azure-485fd2d4.js";import"./react-router-82cc6afb.js";import"./@remix-run-dd360fb4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@headlessui-220c51a1.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./prop-types-20aec754.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./react-string-replace-e94ae631.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./goober-70b4b9ca.js";import"./lodash.debounce-ddb7250b.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";function kt(){var h,_;const[r]=F(),s=re(),u=ne(),m=le(),T=_e(),w=$e(),d=fe(),{dateFormat:I}=de(),[o]=O(J),S=o&&d(o.time_log),p=()=>{G(["tasks"])};return l(ce,{tabs:[r("overview"),r("documents")],width:"full",formatTabLabel:C=>{if(C===1)return e(ye,{numberOfDocuments:o==null?void 0:o.documents.length})},children:[e("div",{children:o&&l(H,{children:[e(B,{leftSide:r("duration"),children:me(o.time_log.toString())}),e(B,{leftSide:r("rate"),children:w(o.rate||m.settings.default_task_rate,(h=o.client)==null?void 0:h.country_id,(_=o.client)==null?void 0:_.settings.currency_id)}),e(B,{leftSide:r("status"),children:e(xe,{entity:o})}),e(Te,{style:{backgroundColor:T,color:"white"},children:e("div",{className:"inline-flex items-center",children:e("span",{children:o.description})})}),S==null?void 0:S.map(([C,V,A],D)=>e(ue,{children:l("div",{className:"flex items-center justify-between",children:[l("div",{className:"flex flex-col",children:[e("p",{children:pe(C,I)}),l("small",{children:[V," - ",A]})]}),e("div",{children:P(o)&&D===S.length-1?e(ge,{task:o,calculateLastTimeLog:!0}):we(o.time_log,D)})]})},D))]})}),l("div",{className:"px-4",children:[e(Ie,{endpoint:Q("/api/v1/tasks/:id/upload",{id:o==null?void 0:o.id}),onSuccess:p,widgetOnly:!0,disableUpload:!s("edit_task")&&!u(o)}),e(Ne,{documents:(o==null?void 0:o.documents)||[],onDocumentDelete:p,disableEditableOptions:!u(o,!0)})]})]})}function Ct(){const[r]=F(),[s,u]=O(J),{dateFormat:m}=de(),[T,w]=f.useState(!1),[d,I]=f.useState(),[o,S]=f.useState([]),p=(a,v)=>{u(k=>k&&{...k,[a]:v})},h=le(),_=Le(),C=fe();f.useEffect(()=>{s!=null&&s.time_log&&S(Ee(s.time_log))},[d,s==null?void 0:s.time_log]);const V=(a,v,k,N)=>{p("time_log",dt(s.time_log,a,v,k,N))},A=(a,v,k,N)=>{p("time_log",ct(s.time_log,a,v,N,k))},D=(a,v,k)=>{p("time_log",mt(s.time_log,a,v,k))};return l(H,{children:[l(he,{title:r("time_log"),visible:T&&o.length>0,onClose:()=>{w(!1),I(void 0)},overflowVisible:!0,children:[o[Number(d)]&&l(H,{children:[e(j,{label:r("start_date"),type:"date",value:ae(o[d][g.Start]),onValueChange:a=>V(o[d][g.Start],a,d,g.Start)}),e(j,{label:r("start_time"),type:"time",step:"1",value:ie(o[d][g.Start]),onValueChange:a=>A(o[d][g.Start],a,g.Start,d)}),(h==null?void 0:h.show_task_end_date)&&e(j,{label:r("end_date"),type:"date",value:ae(o[d][g.End]),onValueChange:a=>V(o[d][g.End],a,d,g.End)}),e(j,{type:"time",step:"1",label:r("end_time"),value:ie(o[d][g.End]),onValueChange:a=>A(o[d][g.End],a,d,g.End)}),e(j,{label:r("duration"),debounceTimeout:1e3,value:nt(o[d][g.Start],o[d][g.End],h==null?void 0:h.show_task_end_date),onValueChange:a=>D(a,o[d][g.Start],d)})]}),e("div",{className:"flex justify-end",children:e(R,{onClick:()=>w(!1),children:r("done")})})]}),l(ce,{tabs:[r("details"),r("times")],width:"full",children:[e("div",{children:l("div",{className:"px-4 space-y-4",children:[e(De,{inputLabel:r("client"),value:s==null?void 0:s.client_id,onChange:a=>p("client_id",a.id)}),e(ke,{inputLabel:r("project"),value:s==null?void 0:s.project_id,onChange:a=>p("project_id",a.id)}),e(je,{inputLabel:r("user"),value:s==null?void 0:s.assigned_user_id,onChange:a=>p("assigned_user_id",a.id)}),e(j,{label:r("task_number"),value:s==null?void 0:s.number,onValueChange:a=>p("number",a)}),e(j,{label:r("rate"),value:s==null?void 0:s.rate,onValueChange:a=>p("rate",a)}),e(lt,{inputLabel:r("status"),value:s==null?void 0:s.status_id,onChange:a=>a&&p("status_id",a.id),onClearButtonClick:()=>p("status_id","")}),e(j,{element:"textarea",value:s==null?void 0:s.description,onValueChange:a=>p("description",a)})]})}),e("div",{children:s&&C(s.time_log).map(([a,v,k],N)=>e(ue,{onClick:()=>{w(!0),I(N)},children:l("div",{children:[e("p",{children:pe(a,m)}),l("small",{children:[v," - ",k]})]})},N))})]}),e("div",{className:"flex justify-end p-4",children:e(R,{onClick:()=>s&&_(s),children:r("save")})})]})}function vt(r){const[s]=F(),{data:u}=Ve(),[m,T]=f.useState(),[w,d]=f.useState(),[I,o]=f.useState(!1),S=(h,_)=>{T(C=>C&&{...C,[h]:_})},p=h=>{if(h.preventDefault(),m&&!I){if(o(!0),M.processing(),Ae(m))return M.error("task_errors");be("POST",Q("/api/v1/tasks"),m).then(()=>{M.success("created_task"),G(["tasks"]),T(u),r.setVisible(!1)}).catch(_=>{var C;((C=_.response)==null?void 0:C.status)===422&&(M.dismiss(),d(_.response.data))}).finally(()=>o(!1))}};return f.useEffect(()=>{u&&r.details&&T({...u,status_id:r.details.taskStatusId,project_id:r.details.projectId?r.details.projectId:""})},[u,r.details]),l(he,{title:s("new_task"),visible:r.visible,onClose:()=>r.setVisible(!1),size:"large",children:[m&&e(ut,{task:m,handleChange:S,errors:w,taskModal:!0}),m&&e(pt,{task:m,handleChange:S}),e(R,{className:"self-end",onClick:p,disabled:!m||I,disableWithoutIcon:!0,children:s("save")})]})}function go(){const{documentTitle:r}=Pe("kanban"),[s]=F(),u=re(),m=ne(),{isAdmin:T,isOwner:w}=Me(),d=[{name:s("tasks"),href:"/tasks"},{name:s("kanban"),href:"/tasks/kanban"}],[I,o]=f.useState(!1),[S,p]=f.useState("/api/v1/tasks?per_page=1000&status=active&without_deleted_clients=true"),[h,_]=f.useState(),[C,V]=f.useState(),[A,D]=f.useState(!1),{data:a}=Oe({status:"active"}),{data:v}=Be({endpoint:S}),[k,N]=f.useState(),[z,U]=f.useState("view"),[b]=O(J),[W,q]=O(at),[X,Y]=O(it),Z=Fe(),ee=ze();ot(W),f.useEffect(()=>{if(a&&v){const n=[];a.data.map(i=>n.push({id:i.id,title:i.name,cards:[]})),v.data.map(i=>{const c=n.findIndex($=>$.id===i.status_id);c>=0&&n[c].cards.push({id:i.id,title:i.description,description:me(i.time_log).toString(),sortOrder:i.status_order,task:i})}),n.map(i=>i.cards=i.cards.sort((c,$)=>c.sortOrder-$.sortOrder)),N(i=>({...i,columns:n}))}},[a,v]);const Ce=n=>{const i={},c=Xe(n.columns).pluck("id").toArray();c.forEach(y=>i[y]=[]),n.columns.forEach(y=>{y.cards.map(L=>i[y.id].push(L.id))});const $={status_ids:c,task_ids:i};M.processing(),be("POST",Q("/api/v1/tasks/sort"),$).then(()=>M.success()).finally(()=>G(["tasks"]))},ve=n=>{var se;const i=tt.cloneDeep(k),c=i.columns.find(x=>x.id===n.source.droppableId),$=i.columns.findIndex(x=>x.id===n.source.droppableId),y=i.columns.find(x=>{var E;return x.id===((E=n.destination)==null?void 0:E.droppableId)}),L=i.columns.findIndex(x=>{var E;return x.id===((E=n.destination)==null?void 0:E.droppableId)});if(c&&$>-1&&y&&L>-1){const x=c.cards.find(E=>E.id===n.draggableId);if(x){i.columns[$].cards=c.cards.filter(K=>K.id!==n.draggableId),i.columns[L].cards.push(x);const E=i.columns[L].cards.findIndex(K=>K.id===n.draggableId);n.destination.index>-1&&(i.columns[L].cards=st(i.columns[L].cards,E,((se=n.destination)==null?void 0:se.index)||0))}}N(i),Ce(i)},te=(n,i)=>{if(i==="edit"&&U("edit"),i==="view"&&U("view"),W===n)return Y(!0);q(n)},Se=()=>{Y(!1),q(void 0)};f.useEffect(()=>{p(h?oe("/api/v1/tasks?project_tasks=:projectId&per_page=1000&status=active&without_deleted_clients=true",{projectId:h}):"/api/v1/tasks?per_page=1000&status=active&without_deleted_clients=true")},[h]);const t=Ke();return l(He,{title:r,breadcrumbs:d,navigationTopRight:e(Re,{to:"/tasks",children:l(Qe,{children:[e(Ue,{size:20}),e("span",{children:s("tasks")})]})}),withoutBackButton:!0,children:[l(rt,{title:b?`${s("task")} ${b.number}`:s("task"),visible:X,onClose:Se,actionChildren:l("div",{className:"flex w-full divide-x-2",style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},children:[z==="view"&&(u("edit_task")||m(b))&&l(ht,{to:oe("/tasks/:id/edit",{id:b==null?void 0:b.id}),className:"flex justify-center items-center text-sm p-4 space-x-2 w-full",children:[e(bt,{size:18}),e("span",{children:s("edit_task")})]}),b&&!P(b)&&(u("edit_task")||m(b))&&l("button",{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},className:"flex justify-center items-center text-sm p-4 space-x-2 w-full",onClick:()=>Z(b),children:[e(ft,{size:18}),e("span",{children:s("start")})]}),b&&P(b)&&(u("edit_task")||m(b))&&l("button",{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},className:"flex justify-center items-center text-sm p-4 space-x-2 w-full",onClick:()=>ee(b),children:[e(gt,{size:18}),e("span",{children:s("stop")})]})]}),size:"regular",withoutActionContainer:!0,children:[z==="view"&&e(kt,{}),z==="edit"&&e(Ct,{})]}),e("div",{className:"grid grid-cols-12 gap-4",style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},children:e(Ge,{className:"col-span-12 xl:col-span-4",children:e(B,{leftSide:s("project"),children:e(ke,{value:h,onChange:n=>_(n.id),onClearButtonClick:()=>_(void 0),clearButton:!0})})})}),k&&l("div",{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4,paddingRight:X?512:0},className:"flex pb-6 space-x-4 overflow-x-auto mt-4",children:[e(Ye,{onDragEnd:ve,children:k.columns.map(n=>e(Ze,{droppableId:n.id,children:i=>l("div",{className:"bg-white rounded shadow select-none h-max",style:{minWidth:360,color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},children:[l("div",{className:"flex items-center justify-between border-b px-4 py-5",style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},children:[e("h3",{className:"leading-6 font-medium ",children:n.title}),u("create_task")&&e(We,{className:"cursor-pointer",fontSize:22,onClick:()=>{V({taskStatusId:n.id,projectId:h}),D(!0)}})]}),e("div",{...i.droppableProps,ref:i.innerRef,className:"p-4 space-y-4",style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},children:n.cards.map((c,$)=>l("div",{className:"w-full text-leftblock rounded bg-gray-50 text-gray-700 hover:text-gray-900 text-sm cursor-pointer group",children:[e(et,{draggableId:c.id,index:$,children:y=>l("div",{ref:y.innerRef,...y.draggableProps,...y.dragHandleProps,className:"bg-gray-50 px-4 sm:px-6 py-4",children:[e("p",{children:c.title}),e("small",{children:P(c.task)?e(ge,{task:c.task}):c.description})]})},c.id),l("div",{className:"hidden group-hover:flex border-t justify-center items-center",style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},children:[(u("view_task")||u("edit_task")||m(b))&&e("button",{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},className:"w-full py-2 rounded-bl",onClick:()=>te(c.id,"view"),children:s("view")}),(u("edit_task")||m(b))&&e("button",{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},className:"w-full text-center py-2",onClick:()=>te(c.id,"edit"),children:s("edit")}),P(c.task)&&(u("edit_task")||m(b))&&e("button",{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},className:"w-full py-2 rounded-br",onClick:()=>ee(c.task),children:s("stop")}),!P(c.task)&&(u("edit_task")||m(b))&&e("button",{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},className:"w-full py-2 rounded-br",onClick:()=>Z(c.task),children:s("start")})]})]},$))}),i.placeholder]})},n.id))}),(T||w)&&e("div",{children:e("div",{className:"bg-white shadow rounded p-1",style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},children:e(qe,{style:{color:t.$3,colorScheme:t.$0,backgroundColor:t.$1,borderColor:t.$4},className:"cursor-pointer",fontSize:28,onClick:()=>o(!0)})})})]}),e(Je,{visible:I,setVisible:o}),e(vt,{visible:A,setVisible:D,details:C,apiEndPoint:S})]})}export{go as default};
