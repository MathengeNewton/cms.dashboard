import{h as k,u as j,j as m,a as t,C,G as c,F,dc as A,aH as d,aO as E,aD as I,dd as D,aN as P,aY as T,s as N,aI as V,bI as w,aP as H,l as L,as as v,de as R,a9 as Y,D as O,df as G}from"./index-e5ac1c37.js";import"./react-redux-7b717b6c.js";import"./classnames-eea0979a.js";import{r as h}from"./react-e483b31d.js";import{P as U}from"./ProjectSelector-c72052c6.js";import{u as B}from"./react-i18next-91d47f13.js";import{P as W}from"./PaymentTypeSelector-baaa0894.js";import{bn as q}from"./dayjs-75976aa4.js";import{u as z}from"./useResolveCurrencySeparator-8a4f7153.js";import"./react-debounce-input-20b6d49d.js";function re(f){var p,_,y,g,b,S;const[r]=B(),{expense:e,handleChange:n,taxInputType:l,pageType:u,errors:i}=f,o=k(),s=j(),x=w();return m("div",{className:"flex flex-col space-y-4",children:[e&&t(C,{children:t(c,{leftSide:r("expense_total"),withoutWrappingLeftSide:!0,children:s(x(e),(p=e.client)==null?void 0:p.country_id,e.currency_id||((_=e.client)==null?void 0:_.settings.currency_id))})}),m(C,{title:r("details"),isLoading:!e,children:[e&&u==="edit"&&m(F,{children:[t(c,{leftSide:r("status"),children:t(A,{entity:e})}),t(c,{leftSide:r("expense_number"),children:t(d,{id:"number",value:e.number,onValueChange:a=>n("number",a),errorMessage:i==null?void 0:i.errors.number})})]}),e&&t(c,{leftSide:r("vendor"),children:t(E,{value:e.vendor_id,onChange:a=>n("vendor_id",a.id),onClearButtonClick:()=>n("vendor_id",""),errorMessage:i==null?void 0:i.errors.vendor_id})}),e&&t(c,{leftSide:r("client"),children:t(I,{value:e.client_id,clearButton:!!e.client_id,onClearButtonClick:()=>n("client_id",""),onChange:a=>n("client_id",a.id),errorMessage:i==null?void 0:i.errors.client_id})}),e&&t(c,{leftSide:r("project"),children:t(U,{value:e.project_id,clearButton:!!e.project_id,onClearButtonClick:()=>n("project_id",""),onChange:a=>n("project_id",a.id),errorMessage:i==null?void 0:i.errors.project_id})}),e&&t(c,{leftSide:r("category"),children:t(D,{value:e.category_id,onClearButtonClick:()=>n("category_id",""),onChange:a=>n("category_id",a.id),errorMessage:i==null?void 0:i.errors.category_id})}),e&&t(c,{leftSide:r("user"),children:t(P,{value:e.assigned_user_id,clearButton:!!e.assigned_user_id,onClearButtonClick:()=>n("assigned_user_id",""),onChange:a=>n("assigned_user_id",a.id),errorMessage:i==null?void 0:i.errors.assigned_user_id})}),e&&(o==null?void 0:o.enabled_expense_tax_rates)>0&&l==="by_rate"&&t(c,{leftSide:r("tax"),children:t(T,{defaultValue:e.tax_name1,onClearButtonClick:()=>{n("tax_name1",""),n("tax_rate1",0)},onChange:a=>{a.resource&&n("tax_rate1",a.resource.rate),a.resource&&n("tax_name1",a.resource.name)},onTaxCreated:a=>{n("tax_rate1",a.rate),n("tax_name1",a.name)}})}),e&&(o==null?void 0:o.enabled_expense_tax_rates)>0&&l==="by_amount"&&t(c,{leftSide:r("tax"),children:m("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[t(d,{label:r("tax_name"),value:e.tax_name1,onValueChange:a=>n("tax_name1",a),errorMessage:i==null?void 0:i.errors.tax_name1,cypressRef:"taxNameByAmount1"}),t(d,{type:"number",label:r("tax_amount"),value:e.tax_amount1,onValueChange:a=>n("tax_amount1",parseFloat(a)),errorMessage:i==null?void 0:i.errors.tax_amount1,cypressRef:"taxRateByAmount1"})]})}),e&&(o==null?void 0:o.enabled_expense_tax_rates)>1&&l==="by_rate"&&t(c,{leftSide:r("tax"),children:t(T,{defaultValue:e.tax_name2,onClearButtonClick:()=>{n("tax_name2",""),n("tax_rate2",0)},onChange:a=>{a.resource&&n("tax_rate2",a.resource.rate),a.resource&&n("tax_name2",a.resource.name)},onTaxCreated:a=>{n("tax_rate2",a.rate),n("tax_name2",a.name)}})}),e&&(o==null?void 0:o.enabled_expense_tax_rates)>1&&l==="by_amount"&&t(c,{leftSide:r("tax"),children:m("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[t(d,{label:r("tax_name"),value:e.tax_name2,onValueChange:a=>n("tax_name2",a),errorMessage:i==null?void 0:i.errors.tax_name2,cypressRef:"taxNameByAmount2"}),t(d,{type:"number",label:r("tax_amount"),value:e.tax_amount2,onValueChange:a=>n("tax_amount2",parseFloat(a)),errorMessage:i==null?void 0:i.errors.tax_amount2,cypressRef:"taxRateByAmount2"})]})}),e&&(o==null?void 0:o.enabled_expense_tax_rates)>2&&l==="by_rate"&&t(c,{leftSide:r("tax"),children:t(T,{defaultValue:e.tax_name3,onClearButtonClick:()=>{n("tax_name3",""),n("tax_rate3",0)},onChange:a=>{a.resource&&n("tax_rate3",a.resource.rate),a.resource&&n("tax_name3",a.resource.name)},onTaxCreated:a=>{n("tax_rate3",a.rate),n("tax_name3",a.name)}})}),e&&(o==null?void 0:o.enabled_expense_tax_rates)>2&&l==="by_amount"&&t(c,{leftSide:r("tax"),children:m("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[t(d,{label:r("tax_name"),value:e.tax_name3,onValueChange:a=>n("tax_name3",a),errorMessage:i==null?void 0:i.errors.tax_name3}),t(d,{type:"number",label:r("tax_amount"),value:e.tax_amount3,onValueChange:a=>n("tax_amount3",parseFloat(a)),errorMessage:i==null?void 0:i.errors.tax_amount3})]})}),e&&t(c,{leftSide:r("amount"),children:t(d,{type:"number",value:e.amount,onValueChange:a=>n("amount",parseFloat(a)||0),errorMessage:i==null?void 0:i.errors.amount})}),e&&t(c,{leftSide:r("currency"),children:t(N,{value:e.currency_id,onChange:a=>n("currency_id",a),errorMessage:i==null?void 0:i.errors.currency_id})}),e&&t(c,{leftSide:r("date"),children:t(d,{type:"date",onValueChange:a=>n("date",a),errorMessage:i==null?void 0:i.errors.date,value:e.date})}),e&&((y=o==null?void 0:o.custom_fields)==null?void 0:y.expense1)&&t(V,{field:"expense1",defaultValue:e.custom_value1||"",value:o.custom_fields.expense1,onValueChange:a=>n("custom_value1",String(a))}),e&&((g=o==null?void 0:o.custom_fields)==null?void 0:g.expense2)&&t(V,{field:"expense2",defaultValue:e.custom_value2||"",value:o.custom_fields.expense2,onValueChange:a=>n("custom_value2",String(a))}),e&&((b=o==null?void 0:o.custom_fields)==null?void 0:b.expense3)&&t(V,{field:"expense3",defaultValue:e.custom_value3||"",value:o.custom_fields.expense3,onValueChange:a=>n("custom_value3",String(a))}),e&&((S=o==null?void 0:o.custom_fields)==null?void 0:S.expense4)&&t(V,{field:"expense4",defaultValue:e.custom_value4||"",value:o.custom_fields.expense4,onValueChange:a=>n("custom_value4",String(a))})]})]})}function ie(f){const[r]=B(),{expense:e,handleChange:n,errors:l}=f;return m(C,{title:r("notes"),isLoading:!e,withContainer:!0,children:[e&&t(d,{value:e.public_notes,label:r("public_notes"),element:"textarea",onValueChange:u=>n("public_notes",u),errorMessage:l==null?void 0:l.errors.public_notes}),e&&t(d,{value:e.private_notes,label:r("private_notes"),element:"textarea",onValueChange:u=>n("private_notes",u),errorMessage:l==null?void 0:l.errors.private_notes})]})}function oe(f){const[r]=B(),{expense:e,handleChange:n,errors:l}=f,u=k(),i=H(),o=z(),s=L(),[x,p]=h.useState({decimalSeparator:",",precision:2,thousandSeparator:"."}),[_,y]=h.useState(),g=()=>!!(e!=null&&e.payment_type_id)||!!(e!=null&&e.payment_date)||!!(e!=null&&e.transaction_reference),b=a=>{if(!a){n("payment_date",""),n("payment_type_id",""),n("transaction_reference","");return}n("payment_date",q().format("YYYY-MM-DD"))},S=a=>{e&&a?(n("foreign_amount",a),e.amount&&n("exchange_rate",a/e.amount)):n("foreign_amount",0)};return h.useEffect(()=>{e&&e.exchange_rate&&e.invoice_currency_id&&e.currency_id?n("foreign_amount",e.amount*e.exchange_rate):n("foreign_amount",0)},[e==null?void 0:e.amount]),h.useEffect(()=>{if(e)if(e.currency_id?n("currency_id",e.currency_id):n("invoice_currency_id",e.invoice_currency_id),e.currency_id&&e.invoice_currency_id){const a=i(e.currency_id),M=i(e.invoice_currency_id);a&&M&&(n("exchange_rate",1/(a==null?void 0:a.exchange_rate)*(M==null?void 0:M.exchange_rate)),e.amount&&n("foreign_amount",e.amount*e.exchange_rate))}else n("foreign_amount",0),n("exchange_rate",1);else n("foreign_amount",0),n("exchange_rate",1)},[e==null?void 0:e.currency_id,e==null?void 0:e.invoice_currency_id]),h.useEffect(()=>{if(e!=null&&e.invoice_currency_id){const a=o(e.invoice_currency_id);a&&p(a)}},[e==null?void 0:e.invoice_currency_id]),h.useEffect(()=>{e&&e.exchange_rate?(n("exchange_rate",e.exchange_rate),e.amount&&e.invoice_currency_id&&e.currency_id&&n("foreign_amount",e.amount*e.exchange_rate)):(n("exchange_rate",1),n("foreign_amount",0))},[e==null?void 0:e.exchange_rate]),h.useEffect(()=>{e&&typeof _>"u"&&y(!!(u!=null&&u.convert_expense_currency)||!!(e!=null&&e.foreign_amount))},[e]),m(C,{title:r("additional_info"),isLoading:!e,children:[e&&t(c,{leftSide:r("should_be_invoiced"),leftSideHelp:r("mark_invoiceable_help"),children:t(v,{checked:e.should_be_invoiced,onChange:a=>n("should_be_invoiced",a),cypressRef:"shouldBeInvoicedToggle"})}),e&&t(c,{leftSide:r("mark_paid"),leftSideHelp:r("mark_paid_help"),children:t(v,{checked:g(),onChange:b,cypressRef:"markPaidToggle"})}),e&&g()&&t(c,{leftSide:r("payment_type"),children:t(W,{value:e.payment_type_id,onChange:a=>n("payment_type_id",a),errorMessage:l==null?void 0:l.errors.payment_type_id})}),e&&g()&&t(c,{leftSide:r("date"),children:t(d,{type:"date",value:e.payment_date,onValueChange:a=>n("payment_date",a),errorMessage:l==null?void 0:l.errors.payment_date})}),e&&g()&&t(c,{leftSide:r("transaction_reference"),children:t(d,{value:e.transaction_reference,onValueChange:a=>n("transaction_reference",a),errorMessage:l==null?void 0:l.errors.transaction_reference})}),e&&t(c,{leftSide:r("convert_currency"),leftSideHelp:r("convert_expense_currency_help"),children:t(v,{checked:_||!1,onChange:a=>y(a),cypressRef:"convertCurrencyToggle"})}),e&&_&&m(F,{children:[t(c,{leftSide:r("currency"),children:t(N,{value:e.invoice_currency_id,onChange:a=>n("invoice_currency_id",a),errorMessage:l==null?void 0:l.errors.invoice_currency_id})}),t(c,{leftSide:r("exchange_rate"),children:t(d,{value:e.exchange_rate.toFixed(5),onValueChange:a=>n("exchange_rate",parseFloat(a)),errorMessage:l==null?void 0:l.errors.exchange_rate})}),t(c,{leftSide:r("converted_amount"),children:t(R,{border:!0,precision:s!=null&&s.number_precision&&(s==null?void 0:s.number_precision)>0&&(s==null?void 0:s.number_precision)<=100?s.number_precision:(x==null?void 0:x.precision)||2,currency:x,className:"auto",initialValue:(e.foreign_amount||0).toString(),onChange:a=>S(parseFloat(a)),errorMessage:l==null?void 0:l.errors.foreign_amount})})]}),e&&t(c,{leftSide:r("add_documents_to_invoice"),leftSideHelp:r("add_documents_to_invoice_help"),children:t(v,{checked:e.invoice_documents,onChange:a=>n("invoice_documents",a),cypressRef:"addDocumentsToInvoiceToggle"})})]})}function le(f){const[r]=B(),{isAdmin:e,isOwner:n}=Y(),{expense:l,handleChange:u,taxInputType:i,setTaxInputType:o}=f,s=k(),x=_=>{_==="by_amount"?(u("tax_rate1",0),u("tax_rate2",0),u("tax_rate3",0)):(u("tax_amount1",0),u("tax_amount2",0),u("tax_amount3",0)),u("tax_name1",""),u("tax_name2",""),u("tax_name3","")},p=_=>{o(_),x(_),u("calculate_tax_by_amount",_==="by_amount")};return m(C,{title:r("taxes"),isLoading:!l,children:[(s==null?void 0:s.enabled_expense_tax_rates)===0&&t(c,{leftSide:r("expense_tax_help"),children:t(O,{to:"/settings/tax_settings",renderSpan:!e&&!n,children:r("settings")})}),(s==null?void 0:s.enabled_expense_tax_rates)>0&&l&&t(c,{leftSide:r("enter_taxes"),children:t(G,{name:"enter_taxes",options:[{id:"by_rate",title:r("by_rate"),value:"by_rate"},{id:"by_amount",title:r("by_amount"),value:"by_amount"}],defaultSelected:i,onValueChange:_=>p(_)})}),(s==null?void 0:s.enabled_expense_tax_rates)>0&&l&&t(c,{leftSide:r("inclusive_taxes"),leftSideHelp:m("span",{className:"flex flex-col",children:[m("span",{children:[r("exclusive"),": 100 + 10% = 100 + 10"]}),m("span",{children:[r("inclusive"),": 100 + 10% = 90.91 + 9.09"]})]}),children:t(v,{onChange:_=>u("uses_inclusive_taxes",_),checked:l.uses_inclusive_taxes,cypressRef:"inclusiveTaxesToggle"})})]})}export{oe as A,re as D,ie as N,le as T};
