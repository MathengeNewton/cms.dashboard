import{bn as U,b as Z,u as W,A as z,E as ee,c as K,V as te,r as P,e as R,a as t,R as ie,j as n,T as se,G as a,g as m,ck as re,H,I as ne,J as I,K as oe,O,P as le,Q as ae,U as me,d as T,D as ce,N as de,y as ue,z as $,v as pe,cl as he,bo as fe,l as _e,bt as be,X as ye,x as xe,f as Ce,Y as ve,Z as Se,_ as D,F as ge,cm as Ne,$ as Te}from"./index-ecbcc3c7.js";import{D as ke}from"./DataTableColumnsPicker-a8c7631c.js";import{I as we}from"./ImportButton-58c4bd54.js";import{a as Ae,u as Ee}from"./useFooterColumns-5120948c.js";import{c as Qe}from"./classnames-eea0979a.js";import{r as k}from"./react-e483b31d.js";import"./react-debounce-input-20b6d49d.js";import"./react-redux-7b717b6c.js";import{S as Ie}from"./Slider-2eda3086.js";import{u as qe,a as j}from"./react-query-557fee5a.js";import{bn as L,bx as Fe}from"./dayjs-75976aa4.js";import{U as Pe,x as Re,d as $e}from"./react-icons-071f44cd.js";import{r as De}from"./react-string-replace-e94ae631.js";import{E as Ve}from"./EmailRecord-3c8f1a2e.js";import{I as Be}from"./InvoiceStatus-e10dbdfb.js";import{u as V}from"./react-i18next-91d47f13.js";import{b as J,u as q}from"./jotai-c7720f6e.js";import{u as Me}from"./queries-fbb304cc.js";import{D as Ge}from"./DataTableFooterColumnsPicker-a28eb27d.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./lodash-bd2b80f6.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./@azure-485fd2d4.js";import"./react-router-82cc6afb.js";import"./@remix-run-dd360fb4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./react-router-dom-67fe6288.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./lodash.debounce-ddb7250b.js";import"./useDownloadPdfs-dc322b9d.js";import"./useSumTableColumn-7473cf49.js";import"./invoice-status-756326ba.js";const X=J(null),Y=J(!1);L.extend(Fe);function He(){const[i]=V();return s=>{var c,b,y,p,h,e,x;let u=ue(`activity_${s.activity_type_id}`,{});const o={client:t($,{to:T("/clients/:id",{id:(c=s.client)==null?void 0:c.hashed_id}),children:(b=s.client)==null?void 0:b.label}),user:((y=s.user)==null?void 0:y.label)??i("system"),quote:t($,{to:T("/quotes/:id/edit",{id:(p=s.quote)==null?void 0:p.hashed_id}),children:(h=s==null?void 0:s.quote)==null?void 0:h.label})??"",contact:t($,{to:T("/clients/:id/edit",{id:(e=s==null?void 0:s.contact)==null?void 0:e.hashed_id}),children:(x=s==null?void 0:s.contact)==null?void 0:x.label})??""};for(const[f,S]of Object.entries(o))u=De(u,`:${f}`,()=>S);return u}}function Oe(){var w,A,E,Q,v,B;const[i]=V(),s=qe(),u=U({showCommonBulkAction:!0,showEditAction:!0}),{dateFormat:o}=Z(),c=W(),b=z(),y=ee(),p=K(),h=He(),[e,x]=q(X),[f,S]=q(Y),[C,F]=k.useState([]),{data:l}=te({id:e==null?void 0:e.invoice_id}),{data:d}=j({queryKey:["/api/v1/quotes",e==null?void 0:e.id,"slider"],queryFn:()=>P("GET",R(`/api/v1/quotes/${e==null?void 0:e.id}?include=activities.history&reminder_schedule=true`)).then(r=>r.data.data),enabled:e!==null&&f,staleTime:1/0}),{data:g}=j({queryKey:["/api/v1/activities",e==null?void 0:e.id,"quote"],queryFn:()=>P("POST",R("/api/v1/activities/entity"),{entity:"quote",entity_id:e==null?void 0:e.id}).then(r=>r.data.data),enabled:e!==null&&f,staleTime:1/0}),N=async()=>{const r=await s.fetchQuery(["/api/v1/quotes",e==null?void 0:e.id,"emailHistory"],()=>P("POST",R("/api/v1/emails/entityHistory"),{entity:"quote",entity_id:e==null?void 0:e.id}),{staleTime:1/0}).then(_=>_.data);F(r)};return k.useEffect(()=>{e&&N()},[e]),t(Ie,{size:"regular",visible:f,onClose:()=>{S(!1),x(null)},title:`${i("quote")} ${e==null?void 0:e.number}`,topRight:e&&(b("edit_quote")||y(e))&&t(ie,{label:i("more_actions"),resource:e,actions:u}),withoutActionContainer:!0,children:n(se,{tabs:[i("overview"),i("history"),i("activity"),i("email_history")],width:"full",children:[n("div",{className:"space-y-2",children:[n("div",{children:[t(a,{leftSide:i("quote_amount"),children:e?c(e==null?void 0:e.amount,(w=e.client)==null?void 0:w.country_id,(A=e.client)==null?void 0:A.settings.currency_id):null}),t(a,{leftSide:i("balance_due"),children:e?c(e.balance,(E=e.client)==null?void 0:E.country_id,(Q=e.client)==null?void 0:Q.settings.currency_id):null}),t(a,{leftSide:i("date"),children:e?m(e==null?void 0:e.date,o):null}),t(a,{leftSide:i("valid_until"),children:e?m(e.due_date,o):null}),t(a,{leftSide:i("status"),children:e?t(re,{entity:e}):null})]}),t(H,{withoutPadding:!0}),n(ne,{className:"w-full",children:[t(I,{className:"text-center",onClick:()=>e&&oe(e),children:n("div",{className:"inline-flex items-center space-x-1",children:[t(O,{element:Pe}),t("p",{children:i("view_portal")})]})}),e?t(I,{className:"text-center",onClick:()=>{navigator.clipboard.writeText(le(e)??""),ae.success("copied_to_clipboard",{value:""})},children:n("div",{className:"inline-flex items-center space-x-1",children:[t(O,{element:Re}),t("p",{children:i("copy_link")})]})}):null]}),t(H,{withoutPadding:!0}),e&&e.next_send_date?n("div",{className:"space-y-2 whitespace-nowrap",children:[t(me,{size:"regular",width:"auto",containsUnsafeHTMLTags:!0,message:(d==null?void 0:d.reminder_schedule)??"",children:n("h3",{className:"flex ml-3 mt-2 italic",children:[i("reminders")," ",t($e,{className:"mt-1 ml-1"})]})}),t(a,{leftSide:i("next_send_date"),children:e?m(e.next_send_date,o):null}),t(a,{leftSide:i("reminder_last_sent"),children:e?m(e.reminder_last_sent,o):null}),e.reminder1_sent?t(a,{leftSide:i("first_reminder"),children:e?m(e.reminder1_sent,o):null}):null,e.reminder2_sent?t(a,{leftSide:i("second_reminder"),children:e?m(e.reminder2_sent,o):null}):null,e.reminder3_sent?t(a,{leftSide:i("third_reminder"),children:e?m(e.reminder3_sent,o):null}):null]}):null,l&&t(I,{to:T("/invoices/:id/edit",{id:l.id}),disableNavigation:p("invoice",l),children:n("div",{className:"flex flex-col space-y-2",children:[n("p",{className:"font-semibold",children:[i("invoice")," ",l.number]}),n("div",{className:"flex items-center space-x-1",children:[t("p",{children:c(l.amount,(v=l.client)==null?void 0:v.country_id,(B=l.client)==null?void 0:B.settings.currency_id)}),t("p",{children:"·"}),t("p",{children:m(l.date,o)})]}),t("div",{children:t(Be,{entity:l})})]})})]}),t("div",{children:(d==null?void 0:d.activities)&&d.activities.map(r=>{var _,M,G;return t(I,{to:`/activities/${r.id}`,children:n("div",{className:"flex flex-col",children:[n("div",{className:"flex space-x-1",children:[t("span",{children:e!=null&&e.client?c(r.history.amount,(_=e==null?void 0:e.client)==null?void 0:_.country_id,(M=e==null?void 0:e.client)==null?void 0:M.settings.currency_id):null}),t("span",{children:"·"}),t(ce,{to:`/clients/${r.client_id}`,renderSpan:p("client",e==null?void 0:e.client),children:(G=e==null?void 0:e.client)==null?void 0:G.display_name})]}),n("div",{className:"inline-flex items-center space-x-1",children:[t("p",{children:m(r.created_at,`${o} h:mm:ss A`)}),t("p",{children:L.unix(r.created_at).fromNow()})]})]})},r.id)})}),t("div",{children:g==null?void 0:g.map(r=>n(de,{className:"flex flex-col",children:[t("p",{children:h(r)}),n("div",{className:"inline-flex items-center space-x-1",children:[t("p",{children:m(r.created_at,`${o} h:mm:ss A`)}),t("p",{children:"·"}),t("p",{children:r.ip})]})]},r.id))}),t("div",{className:"flex flex-col",children:C==null?void 0:C.map((r,_)=>t(Ve,{className:"py-4",emailRecord:r,index:_},_))})]})})}function Ui(){const{documentTitle:i}=pe("quotes"),[s]=V(),u=z(),o=K(),[c,b]=k.useState(""),[y,p]=q(X),[h,e]=q(Y),x=U(),f=he(),S=fe(),C=_e(),F=be(),l=Ae(),{footerColumns:d,allFooterColumns:g}=Ee(),{data:N}=Me({id:c}),w=[{name:s("quotes"),href:T("/quotes")}];k.useEffect(()=>{N&&h&&p(N)},[N,h]),k.useEffect(()=>()=>e(!1),[]);const{changeTemplateVisible:A,setChangeTemplateVisible:E,changeTemplateResources:Q}=ye();return n(xe,{title:i,breadcrumbs:w,withoutBackButton:!0,children:[t(Ce,{resource:"quote",columns:S,footerColumns:d,endpoint:"/api/v1/quotes?include=client&without_deleted_clients=true&sort=id|desc",linkToEdit:"/quotes/:id/edit",linkToCreate:"/quotes/create",bulkRoute:"/api/v1/quotes/bulk",customActions:x,customBulkActions:l,customFilters:f,customFilterPlaceholder:"status",withResourcefulActions:!0,rightSide:t(ve,{type:"component",guards:[Se(D("create_quote"),D("edit_quote"))],component:t(we,{route:"/quotes/import"})}),leftSideChevrons:n("div",{className:Qe("flex items-center space-x-1",{"pr-4":!!C.show_table_footer}),children:[!!C.show_table_footer&&n(ge,{children:[t(Ge,{table:"quote",columns:g}),t("span",{children:"|"})]}),t(ke,{columns:F,defaultColumns:Ne,table:"quote"})]}),onTableRowClick:v=>{b(v.id),e(!0)},linkToCreateGuards:[D("create_quote")],hideEditableOptions:!u("edit_quote")}),!o("quote",y)&&t(Oe,{}),t(Te,{entity:"quote",entities:Q,visible:A,setVisible:E,labelFn:v=>`${s("number")}: ${v.number}`,bulkUrl:"/api/v1/quotes/bulk"})]})}export{Ui as default};
