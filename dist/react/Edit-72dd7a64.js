import{v as H,c8 as Q,l as V,A as Y,E as q,d as J,cb as K,bw as W,cf as X,k as Z,j as m,x as tt,a as e,R as it,C as et,c3 as ot,T as rt,aA as T,aB as n,S as k,c7 as c,O as A,a6 as st,ce as nt}from"./index-ecbcc3c7.js";import{y as at}from"./lodash-bd2b80f6.js";import{C as mt}from"./ClientSelector-8b233044.js";import{u as pt,I as ct,a as lt}from"./useProductColumns-62bcf2b6.js";import{r as p}from"./react-e483b31d.js";import{u as dt}from"./react-router-dom-67fe6288.js";import{I as ut,a as Ct,C as ht,c as vt}from"./ConfirmActionModal-de7c3425.js";import{N as ft,Y as _t}from"./react-icons-071f44cd.js";import"./classnames-eea0979a.js";import{u as gt}from"./useTaskColumns-fe4d1c28.js";import{u as St}from"./react-i18next-91d47f13.js";import{e as yt}from"./react-router-82cc6afb.js";import{v as It}from"./uuid-4a60fe23.js";import{u as f}from"./jotai-c7720f6e.js";import"./react-redux-7b717b6c.js";import"./react-dom-ce3e84ee.js";import"./@babel-e5cbf021.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-2fceee1f.js";import"./react-is-e8e5dbb3.js";import"./use-sync-external-store-7794fa59.js";import"./dayjs-75976aa4.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./react-query-557fee5a.js";import"./@azure-485fd2d4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-debounce-input-20b6d49d.js";import"./lodash.debounce-ddb7250b.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./react-string-replace-e94ae631.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./@remix-run-dd360fb4.js";import"./InvoiceViewer-a729b03c.js";import"./ProjectSelector-0c0e158e.js";import"./DesignSelector-1def70e7.js";import"./designs-863b1b5c.js";function ye(){const{t:r}=St(),{id:_}=yt(),{documentTitle:R}=H("edit_recurring_invoice"),{data:l}=Q({id:_}),d=V(),b=Y(),P=q(),[w,x]=p.useState(),D=[{name:r("recurring_invoices"),href:"/recurring_invoices"},{name:r("edit_recurring_invoice"),href:J("/recurring_invoices/:id/edit",{id:_})}],[t,L]=f(st),[N]=f(nt),[u,O]=p.useState(),[a,E]=p.useState(),{handleChange:s,handleInvitationChange:F,handleLineItemChange:g,handleLineItemPropertyChange:S,handleCreateLineItem:y,handleDeleteLineItem:I,calculateInvoiceSum:M}=K({client:u}),$=pt();p.useEffect(()=>{if(l){const i=at.cloneDeep(l);i.line_items.map(o=>o._id=It()),L(i),i&&i.client&&O(i.client)}},[l]);const j=W(),C=X({setErrors:E}),[,U]=f(vt),B=i=>{let o;if((i==null?void 0:i.status_id)===c.DRAFT&&(o=[{onClick:()=>U(!0),label:r("send_now"),icon:e(A,{element:ft})}]),i.status_id===c.DRAFT||i.status_id===c.PAUSED){const v={onClick:()=>C(i,"start"),label:r("start"),icon:e(A,{element:_t})};o?o=[...o,v]:o=[v]}x(o)};p.useEffect(()=>{t&&M(t),t&&B(t)},[t]);const[z]=dt(),G=gt(),h=Z();return m(tt,{title:R,breadcrumbs:D,...(b("edit_recurring_invoice")||P(t))&&t&&{onSaveClick:()=>C(t),navigationTopRight:e(it,{resource:t,label:r("more_actions"),actions:j,cypressRef:"recurringInvoiceActionDropdown"}),additionalSaveOptions:w},children:[m("div",{className:"grid grid-cols-12 gap-4",children:[m(et,{className:"col-span-12 xl:col-span-4 h-max",withContainer:!0,children:[t&&m("div",{className:"flex space-x-20",children:[e("span",{className:"text-sm",style:{backgroundColor:h.$2,color:h.$3,colorScheme:h.$0},children:r("status")}),e(ot,{entity:t})]}),e(mt,{resource:t,onChange:i=>s("client_id",i),onClearButtonClick:()=>s("client_id",""),onContactCheckboxChange:F,errorMessage:a==null?void 0:a.errors.client_id,textOnly:!0,readonly:!0})]}),e(ut,{handleChange:s,errors:a}),e("div",{className:"col-span-12",children:m(rt,{tabs:[r("products"),r("tasks")],defaultTabIndex:z.get("table")==="tasks"?1:0,children:[e("div",{children:t&&u?e(T,{type:"product",resource:t,items:t.line_items.filter(i=>[n.Product,n.UnpaidFee,n.PaidFee,n.LateFee].includes(i.type_id)),columns:$,relationType:"client_id",onLineItemChange:g,onSort:i=>s("line_items",i),onLineItemPropertyChange:S,onCreateItemClick:()=>y(n.Product),onDeleteRowClick:I}):e(k,{})}),e("div",{children:t&&u?e(T,{type:"task",resource:t,items:t.line_items.filter(i=>i.type_id===n.Task),columns:G,relationType:"client_id",onLineItemChange:g,onSort:i=>s("line_items",i),onLineItemPropertyChange:S,onCreateItemClick:()=>y(n.Task),onDeleteRowClick:I}):e(k,{})})]})}),e(Ct,{handleChange:s,errors:a}),t&&e(ct,{relationType:"client_id",resource:t,invoiceSum:N,onChange:(i,o)=>s(i,o)})]}),(d==null?void 0:d.show_pdf_preview)&&e("div",{className:"my-4",children:t&&e(lt,{for:"invoice",resource:t,entity:"recurring_invoice",relationType:"client_id",endpoint:"/api/v1/live_preview?entity=:entity",withRemoveLogoCTA:!0})}),(t==null?void 0:t.status_id)===c.DRAFT?e(ht,{onClick:()=>C(t,"send_now")}):null]})}export{ye as default};
