import{aj as O,a as e,F as h,j as o,bh as j,al as L,aG as B,h as x,bi as H,u as C,G as _,am as V,z as v,O as w,bj as $,d as m,bk as q,w as F,A as T,E as S,aJ as Q,bl as z,r as E,e as P,v as D,bg as U,b5 as J,X,x as W,R as Y,S as Z,bm as K,$ as ee}from"./index-ecbcc3c7.js";import{r as f}from"./react-e483b31d.js";import{I as y}from"./InfoCard-eeea6490.js";import{u as g}from"./react-i18next-91d47f13.js";import"./classnames-eea0979a.js";import"./react-debounce-input-20b6d49d.js";import"./react-redux-7b717b6c.js";import{G as te,aa as ie,ab as se,ac as ne}from"./react-icons-071f44cd.js";import{e as N,a as ae,O as re}from"./react-router-82cc6afb.js";import"./lodash-bd2b80f6.js";import"./i18next-076b76a4.js";import"./react-hot-toast-d3a0fddd.js";import{a as oe,u as ce}from"./react-query-557fee5a.js";import"./react-qr-code-d89187e6.js";import"./react-verification-input-7fc81ee7.js";import"./dayjs-75976aa4.js";import"./axios-60492c0c.js";import"./react-phone-number-input-4fffe465.js";import"./collect.js-ebd014c9.js";import"./@tinymce-7238a8f2.js";import{E as le}from"./EmailRecord-3c8f1a2e.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./@azure-485fd2d4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./jotai-c7720f6e.js";import"./react-router-dom-67fe6288.js";import"./@remix-run-dd360fb4.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./react-string-replace-e94ae631.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./goober-70b4b9ca.js";import"./lodash.debounce-ddb7250b.js";import"./qr.js-8bf59ccc.js";function me(l){var a;const{t:s}=g(),i=O(),{client:t}=l;return e(h,{children:t&&e("div",{className:"col-span-12 lg:col-span-3",children:e(y,{title:s("address"),value:o(h,{children:[o("p",{children:[t.address1.length>0&&t.address1,t.address1.length>0&&e("br",{}),t.address2]}),o("p",{children:[t.city.length>0&&t.city,"  ",t.state,"  ",t.postal_code.length>0&&t.postal_code]}),e("p",{children:(a=i(t.country_id))==null?void 0:a.name}),e("span",{className:"whitespace-normal",dangerouslySetInnerHTML:{__html:t.public_notes}})]}),className:"h-full"})})})}function de(l){const[s]=g(),i=j(),{client:t}=l;return e(h,{children:t&&e("div",{className:"col-span-12 lg:col-span-3",children:e(y,{title:s("contacts"),value:e("div",{className:"space-y-2",children:t.contacts.map((a,n)=>o("div",{className:"flex justify-between items-center",children:[o("div",{children:[o("p",{className:"font-semibold",style:{color:i},children:[a.first_name," ",a.last_name]}),e("p",{children:a.phone}),e(L,{text:a.email})]}),a.is_locked&&e(B,{})]},n))}),className:"h-full"})})})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function pe(){const l=x(),{data:s}=H({perPage:1e3});return(i,t)=>{if(s&&i){if(i.settings[t]!==void 0)return`Client: ${i.settings[t]}`;if(i.group_settings&&i.group_settings.settings[t]!==void 0)return`Group: ${i.group_settings.settings[t]}`;if(i.group_settings_id&&!i.group_settings){const a=s.find(({id:n})=>n===i.group_settings_id);if(a&&a.settings[t]!==void 0)return`Group: ${a.settings[t]}`}return`Company: ${l.settings[t]}`}}}function ue(l){const[s]=g(),{client:i}=l,t=x(),a=pe(),n=C();return e(h,{children:i&&e("div",{className:"col-span-12 lg:col-span-3",children:e(y,{title:s("details"),value:o(h,{children:[e(_,{leftSide:s("status"),noExternalPadding:!0,children:e(V,{entity:i})}),e(v,{to:i.website,external:!0,children:i.website}),i.vat_number.length>1&&o("p",{children:[s("vat_number"),": ",i.vat_number]}),i.phone.length>1&&o("p",{children:[s("phone"),": ",i.phone]}),parseFloat(i.settings.default_task_rate)>0&&o("p",{className:"space-x-1",children:[o("span",{children:[s("task_rate"),":"]}),e("span",{children:i.settings.default_task_rate?n(i.settings.default_task_rate,i.country_id,i.settings.currency_id):n(t.settings.default_task_rate,i.country_id,t.settings.currency_id)})]}),e("span",{"data-cy":"settingsTestingSpan",children:a(l.client,"military_time")})]}),className:"h-full"})})})}function he(l){const[s]=g(),i=C(),{client:t}=l;return e(h,{children:t&&e("div",{className:"col-span-12 lg:col-span-3",children:e(y,{title:s("standing"),value:o("div",{className:"flex flex-col space-y-2",children:[e(_,{leftSide:e("span",{className:"font-bold",children:s("paid_to_date")}),pushContentToRight:!0,noExternalPadding:!0,noVerticalPadding:!0,children:i(t.paid_to_date,t.country_id,t.settings.currency_id)}),e(_,{leftSide:e("span",{className:"font-bold",children:s("outstanding")}),pushContentToRight:!0,noExternalPadding:!0,noVerticalPadding:!0,children:i(t.balance,t.country_id,t.settings.currency_id)}),e(_,{leftSide:e("span",{className:"font-bold",children:s("credit_balance")}),pushContentToRight:!0,noExternalPadding:!0,noVerticalPadding:!0,children:i(t.credit_balance,t.country_id,t.settings.currency_id)}),t.payment_balance>0&&e(_,{leftSide:e("span",{className:"font-bold",children:s("payment_balance")}),pushContentToRight:!0,noExternalPadding:!0,noVerticalPadding:!0,children:i(t.payment_balance,t.country_id,t.settings.currency_id)}),t.private_notes&&o("div",{className:"flex items-center space-x-1",children:[e("div",{children:e(w,{element:te,size:24})}),e("span",{className:"whitespace-normal",dangerouslySetInnerHTML:{__html:t.private_notes}})]})]}),className:"h-full"})})})}function ge(l){const[s]=g(),{data:i}=$(),{client:t}=l,[a,n]=f.useState(),r=c=>a==null?void 0:a.find(({id:p})=>p===c),d=c=>!!(c&&(c==="d14dd26a37cecc30fdd65700bfb55b23"||c==="d14dd26a47cecc30fdd65700bfb67b34"));return f.useEffect(()=>{i&&n(i.data.data)},[i]),e("div",{className:"col-span-12 lg:col-span-4",children:e(y,{title:s("payment_methods"),className:"max-h-96 overflow-y-auto",children:t.gateway_tokens.map(c=>{var p,u;return o("div",{className:"flex items-center justify-between my-2.5",children:[o("div",{className:"flex flex-col space-y-1.5",children:[o("div",{className:"inline-flex items-center space-x-1",children:[e("div",{children:e(ie,{fontSize:22})}),o("div",{className:"inline-flex items-center",children:[e("span",{children:s("gateway")}),e(se,{size:20}),e(v,{to:m("/settings/gateways/:id/edit",{id:c.company_gateway_id}),children:(p=r(c.company_gateway_id))==null?void 0:p.label})]})]}),o("div",{className:"flex items-center space-x-2",children:[e(q,{name:c.meta.brand}),o("div",{className:"flex items-center",children:[e("span",{className:"mt-1",children:"****"}),e("span",{className:"ml-1",children:c.meta.last4})]}),o("span",{children:[c.meta.exp_month,"/",c.meta.exp_year]})]})]}),d((u=r(c.company_gateway_id))==null?void 0:u.gateway_key)&&e(v,{external:!0,to:m("https://dashboard.stripe.com/customers/:customerReference",{customerReference:c.gateway_customer_reference}),children:e(w,{element:ne,size:18})})]},c.id)})})})}function fe(l){const[s]=g(),i=F(),t=T(),a=S(),{id:n}=N(),{client:r,isPurgeOrMergeActionCalled:d}=l,{data:c}=oe({queryKey:["/api/v1/documents",n,"client"],queryFn:()=>E("POST",P("/api/v1/clients/:id/documents",{id:n})).then(u=>u.data.data),staleTime:1/0,enabled:!!n&&!d});let p=[{name:s("invoices"),href:m("/clients/:id",{id:n})},{name:s("quotes"),href:m("/clients/:id/quotes",{id:n})},{name:s("payments"),href:m("/clients/:id/payments",{id:n})},{name:s("recurring_invoices"),href:m("/clients/:id/recurring_invoices",{id:n})},{name:s("credits"),href:m("/clients/:id/credits",{id:n})},{name:s("projects"),href:m("/clients/:id/projects",{id:n})},{name:s("tasks"),href:m("/clients/:id/tasks",{id:n})},{name:s("expenses"),href:m("/clients/:id/expenses",{id:n})},{name:s("recurring_expenses"),href:m("/clients/:id/recurring_expenses",{id:n})},{name:s("activity"),href:m("/clients/:id/activities",{id:n})},{name:s("documents"),href:m("/clients/:id/documents",{id:n}),enabled:t("view_client")||t("edit_client")||a(r),formatName:()=>e(Q,{numberOfDocuments:c==null?void 0:c.length})}];return z.forEach(u=>{i(u.bitmask)||(p=p.filter(b=>b.name!==s(u.label)))}),p}function ye(){const[l]=g(),s=ce(),{id:i}=N(),[t,a]=f.useState([]),n=async()=>{const r=await s.fetchQuery(["/api/v1/clients",i,"emailHistory"],()=>E("POST",P("/api/v1/emails/clientHistory/:id",{id:i})).then(d=>d.data),{staleTime:1/0});a(r)};return f.useEffect(()=>{n()},[]),e(h,{children:!!t.length&&e("div",{className:"col-span-12 lg:col-span-5 xl:col-span-4",children:e(y,{title:l("email_history"),className:"max-h-96 overflow-y-auto",value:t.map((r,d)=>r&&e(le,{emailRecord:r,index:d,withBottomBorder:!0,withEntityNavigationIcon:!0},d))})})})}function mi(){const{documentTitle:l,setDocumentTitle:s}=D("view_client"),[i]=g(),[t,a]=f.useState(!1),{id:n}=N(),{data:r,isLoading:d}=U({id:n,enabled:!!n&&!t}),c=[{name:i("clients"),href:"/clients"},{name:l,href:m("/clients/:id",{id:n})}],p=fe({client:r,isPurgeOrMergeActionCalled:t}),u=J({setIsPurgeOrMergeActionCalled:a}),b=ae(),R=T(),G=S();f.useEffect(()=>(s((r==null?void 0:r.display_name)||"view_client"),()=>{a(!1)}),[r]);const{changeTemplateVisible:M,setChangeTemplateVisible:A,changeTemplateResources:k}=X();return o(W,{title:l,breadcrumbs:c,navigationTopRight:r&&(R("edit_client")||G(r))&&e(Y,{resource:r,actions:u,saveButtonLabel:i("edit"),onSaveClick:()=>b(m("/clients/:id/edit",{id:n})),cypressRef:"clientActionDropdown"}),children:[d&&e(Z,{}),r&&o(h,{children:[o("div",{className:"grid grid-cols-12 space-y-4 lg:space-y-0 lg:gap-4",children:[e(ue,{client:r}),e(me,{client:r}),e(de,{client:r}),e(he,{client:r}),r.gateway_tokens.length>0&&e(ge,{client:r}),e(ye,{})]}),e(K,{tabs:p,className:"mt-6"}),e("div",{className:"my-4",children:e(re,{context:{isPurgeOrMergeActionCalled:t}})}),e(ee,{entity:"client",entities:k,visible:M,setVisible:A,labelFn:I=>`${i("number")}: ${I.number}`,bulkUrl:"/api/v1/clients/bulk"})]})]})}export{mi as default};
