import{cC as x,k as Q,h as W,j as g,cM as U,cN as K,a as e,cO as M,cP as X,F as P,cQ as F,cR as T,aH as S,aE as Z,bh as q,a9 as G,cS as ee,a3 as te,cT as se,cU as ae,p as le,a_ as ie,e as I,Q as H,r as ne,ao as oe,A as re,E as ce,cJ as de,cK as ue,cD as me,C as Y,G as V,cy as he,cz as D,aD as _e,z as J,d as A,O as R,aN as fe,aI as E,T as ge}from"./index-ecbcc3c7.js";import"./react-redux-7b717b6c.js";import"./classnames-eea0979a.js";import{r as $}from"./react-e483b31d.js";import{bn as C}from"./dayjs-75976aa4.js";import"./i18next-076b76a4.js";import"./react-query-557fee5a.js";import{u as z}from"./react-i18next-91d47f13.js";import{w as pe,x as Ce,Q as ke,V as Se}from"./react-feather-90dbe0b6.js";import{P as ve}from"./ProjectSelector-0c0e158e.js";import{T as be}from"./TaskClock-02506fba.js";import{ac as L}from"./react-icons-071f44cd.js";import{b as Te}from"./react-router-82cc6afb.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function j(n){if(n!==0)return C.unix(n).format("YYYY-MM-DD")}function O(n){if(n!==0)return C.unix(n).format("HH:mm:ss")}function xe(n,l,m){const f=j(n),d=O(l);let s=C.unix(l).diff(C.unix(n),"seconds");if(!m&&s<0&&l){const c=C(`${f} ${d}`,"YYYY-MM-DD HH:mm:ss").unix();s=C.unix(c).diff(C.unix(n),"seconds")}if(s<0)return"00:00:00";if(l&&f!=="1970-01-01"){let c=Math.floor(s/3600).toString();s-=Number(c)*3600;let t=Math.floor(s/60).toString();s-=Number(t)*60;let u=s.toString();return Number(c)<10&&(c="0"+c.toString()),Number(t)<10&&(t="0"+t.toString()),Number(u)<10&&(u="0"+u.toString()),c+":"+t+":"+u}else return"00:00:00"}function Ne(n,l,m,f,d){const s=j(l||C().unix()),c=C(`${s} ${m}`,"YYYY-MM-DD HH:mm:ss").unix(),t=x(n);return t[d][f]=c,JSON.stringify(t)}function Me(n,l,m,f,d){const s=O(l||C().unix()),c=C(`${m} ${s}`,"YYYY-MM-DD HH:mm:ss").unix(),t=x(n);return t[f][d]=c,JSON.stringify(t)}function Ve(n,l,m,f){let d=C.unix(m);const s=l.split(":");s[0]&&(d=d.add(parseFloat(s[0]),"hour")),s[1]&&(d=d.add(parseFloat(s[1]),"minute")),s[2]&&(d=d.add(parseFloat(s[2]),"second"));const c=x(n);return c[f][1]=d.unix(),JSON.stringify(c)}var $e=(n=>(n[n.Start=0]="Start",n[n.End=1]="End",n[n.Description=2]="Description",n[n.Billable=3]="Billable",n))($e||{});function Re(n){const{task:l,handleChange:m}=n,[f]=z(),d=Q(),s=W(),[c,t]=$.useState(),u=()=>{const a=x(l.time_log),o=a.at(-1);let _=C().unix();o&&o[1]!==0&&(_=o[1]+1),a.push([_,0,"",!0]),m("time_log",JSON.stringify(a))},r=a=>{const o=x(l.time_log);o.splice(a,1),m("time_log",JSON.stringify(o))},v=(a,o,_,p)=>{t(p),m("time_log",Ne(l.time_log,a,o,_,p))},h=(a,o,_,p)=>{t(_),m("time_log",Me(l.time_log,a,o,_,p))},N=(a,o,_)=>{t(_),m("time_log",Ve(l.time_log,a,o,_))},b=(a,o,_)=>{const p=x(l.time_log);p[o][_]=a,m("time_log",JSON.stringify(p))},w=(a,o,_)=>{const p=x(l.time_log);p[o][_]=a,m("time_log",JSON.stringify(p))},y=()=>{let a=4;return s!=null&&s.show_task_end_date&&(a+=1),s!=null&&s.settings.allow_billable_task_items&&(a+=1),a};return $.useEffect(()=>{if(typeof c=="number"){const a=x(l.time_log),o=a[c]&&a[c][0],_=a[c]&&a[c][1];o&&_&&o>_&&(a[c][1]=o,m("time_log",JSON.stringify(a))),t(void 0)}},[c]),g(U,{children:[g(K,{children:[e(M,{children:f("start_date")}),e(M,{children:f("start_time")}),(s==null?void 0:s.show_task_end_date)&&e(M,{children:f("end_date")}),e(M,{children:f("end_time")}),e(M,{children:f("duration")}),(s==null?void 0:s.settings.allow_billable_task_items)&&e(M,{children:f("billable")}),e(M,{})]}),g(X,{children:[l.time_log&&JSON.parse(l.time_log).map(([a,o,_,p],k)=>g(P,{children:[g(F,{children:[e(T,{children:e(S,{style:{color:d.$3,colorScheme:d.$0},type:"date",value:j(a),onValueChange:i=>h(a,i,k,0)})}),e(T,{children:e(S,{style:{color:d.$3,colorScheme:d.$0},type:"time",step:"1",value:O(a),onValueChange:i=>v(a,i,0,k)})}),(s==null?void 0:s.show_task_end_date)&&e(T,{children:e(S,{style:{color:d.$3,colorScheme:d.$0},type:"date",value:j(o),onValueChange:i=>h(o,i,k,1)})}),e(T,{children:e(S,{style:{color:d.$3,colorScheme:d.$0},type:"time",step:"1",value:O(o)||0,onValueChange:i=>v(o,i,1,k)})}),e(T,{children:e(S,{debounceTimeout:1e3,value:xe(a,o,s==null?void 0:s.show_task_end_date),onValueChange:i=>N(i,a,k)})}),(s==null?void 0:s.settings.allow_billable_task_items)&&e(T,{children:e(Z,{style:{color:d.$3,colorScheme:d.$0},checked:p||typeof p>"u",onValueChange:(i,B)=>w(B||!1,k,3)})}),e(T,{rowSpan:s!=null&&s.settings.show_task_item_description?2:1,children:e("button",{style:{color:d.$3},className:"ml-2 text-gray-600 hover:text-red-600",onClick:()=>r(k),children:e(pe,{size:18})})})]}),(s==null?void 0:s.settings.show_task_item_description)&&e(F,{children:e(T,{colSpan:y(),children:e(S,{element:"textarea",textareaRows:2,value:_,onValueChange:i=>b(i,k,2)})})})]})),e(F,{className:"bg-slate-100 hover:bg-slate-200",children:e(T,{colSpan:100,children:g("button",{onClick:u,className:"w-full py-2 inline-flex justify-center items-center space-x-2",children:[e(Ce,{size:18}),e("span",{children:f("add_item")})]})})})]})]})}function ye(n){var y;const[l]=z(),m=q(),{isAdmin:f,isOwner:d}=G(),[s,c]=$.useState(!1),[t,u]=$.useState(!1),[r,v]=$.useState(),[h,N]=$.useState(),{data:b}=ee({enabled:s}),w=()=>{t||(H.processing(),N(void 0),u(!0),ne("POST",I("/api/v1/task_statuses"),r).then(a=>{H.success("created_task_status"),oe(["task_statuses"]),v(b),n.onChange(a.data.data),c(!1)}).catch(a=>{var o;((o=a.response)==null?void 0:o.status)===422&&(N(a.response.data),H.dismiss())}).finally(()=>u(!1)))};return $.useEffect(()=>{b&&v(b)},[b]),g(P,{children:[g(te,{title:l("new_task_status"),visible:s,onClose:()=>{c(!1),v(b)},children:[e(S,{required:!0,label:l("name"),value:r==null?void 0:r.name,onValueChange:a=>v(o=>o&&{...o,name:a}),errorMessage:h==null?void 0:h.errors.name}),e(se,{children:l("color")}),e(ae,{value:(r==null?void 0:r.color)||m,onValueChange:a=>v(o=>o&&{...o,color:a})}),e(le,{className:"self-end",behavior:"button",onClick:w,children:l("save")})]}),e(ie,{endpoint:I("/api/v1/task_statuses?status=active"),onChange:a=>a.resource&&n.onChange(a.resource),inputOptions:{label:(y=n.inputLabel)==null?void 0:y.toString(),value:n.value||null},entryOptions:{id:"id",label:"name",value:"id"},action:{label:l("new_task_status"),onClick:()=>c(!0),visible:f||d},onDismiss:n.onClearButtonClick,readonly:n.readonly,errorMessage:n.errorMessage})]})}function Le(n){var o,_,p,k;const[l]=z(),m=Q(),{isAdmin:f,isOwner:d}=G(),s=re(),c=ce(),{task:t,handleChange:u,errors:r,page:v}=n,h=W(),N=Te(),b=q(),w=de(),y=ue(),a=me(t.time_log,{inSeconds:!0,calculateLastTimeLog:!1});return g("div",{className:"grid grid-cols-12 gap-4",children:[g(Y,{className:"col-span-12 xl:col-span-4 h-max",children:[t&&v==="edit"&&e(V,{leftSide:l("status"),children:g("div",{className:"grid grid-cols-3 gap-2",children:[e("div",{className:"flex items-center",children:e(he,{entity:t})}),D(t)&&e("div",{className:"flex items-center",children:e(be,{task:t})}),!D(t)&&e("div",{className:"flex items-center",children:!D(t)&&a&&e("p",{children:new Date(Number(a)*1e3).toISOString().slice(11,19)})}),g("div",{children:[!D(t)&&!t.invoice_id&&e(ke,{className:"mr-0 ml-auto",color:"#808080",size:60,stroke:b,strokeWidth:"1",onClick:()=>(s("edit_task")||c(t))&&w(t),cursor:s("edit_task")||c(t)?"pointer":"not-allowed"}),D(t)&&!t.invoice_id&&e(Se,{className:"mr-0 ml-auto cursor-pointer",color:"#808080",size:60,stroke:b,strokeWidth:"1",onClick:()=>(s("edit_task")||c(t))&&y(t),cursor:s("edit_task")||c(t)?"pointer":"not-allowed"})]})]})}),!t.project_id&&e(V,{leftSide:l("client"),children:g("div",{className:"flex items-center justify-center",children:[e("span",{className:"flex flex-1 item-center gap-2",style:{color:m.$3,colorScheme:m.$0},children:e(_e,{onChange:i=>{var B;u("client_id",i.id),t.id||u("rate",((B=i==null?void 0:i.settings)==null?void 0:B.default_task_rate)??0)},value:t.client_id,clearButton:!!t.client_id,onClearButtonClick:()=>u("client_id",""),errorMessage:r==null?void 0:r.errors.client_id})}),(t==null?void 0:t.client_id)&&e("span",{className:"flex item-center gap-2 pl-2",style:{color:m.$3,colorScheme:m.$0},children:e(J,{to:A("/clients/:id",{id:t.client_id}),children:e(R,{element:L,size:18})})})]})}),e(V,{leftSide:l("project"),children:g("div",{className:"flex items-center justify-center",children:[e("span",{className:"flex flex-1 item-center gap-2",style:{color:m.$3,colorScheme:m.$0},children:e(ve,{onChange:i=>{u("project_id",i.id),u("client_id",""),u("rate",i.task_rate)},value:t.project_id,clearButton:!!t.project_id,onClearButtonClick:()=>u("project_id",""),errorMessage:r==null?void 0:r.errors.project_id})}),(t==null?void 0:t.project_id)&&e("span",{className:"flex item-center gap-2 pl-2",style:{color:m.$3,colorScheme:m.$0},children:e(J,{to:A("/projects/:id",{id:t.project_id}),children:e(R,{element:L,size:18})})})]})}),e(V,{leftSide:l("user"),children:e(fe,{value:t==null?void 0:t.assigned_user_id,onChange:i=>u("assigned_user_id",i.id),onClearButtonClick:()=>u("assigned_user_id",""),errorMessage:r==null?void 0:r.errors.assigned_user_id,readonly:!s("edit_task")})}),t&&((o=h==null?void 0:h.custom_fields)==null?void 0:o.task1)&&e(E,{field:"task1",defaultValue:t.custom_value1||"",value:h.custom_fields.task1,onValueChange:i=>u("custom_value1",i)}),t&&((_=h==null?void 0:h.custom_fields)==null?void 0:_.task2)&&e(E,{field:"task2",defaultValue:t.custom_value2||"",value:h.custom_fields.task2,onValueChange:i=>u("custom_value2",i)})]}),g(Y,{className:"col-span-12 xl:col-span-4 h-max",children:[e(V,{leftSide:l("task_number"),children:e(S,{value:t.number,onValueChange:i=>u("number",i),errorMessage:r==null?void 0:r.errors.number})}),e(V,{leftSide:l("rate"),children:e(S,{type:"number",value:t.rate,onValueChange:i=>u("rate",parseFloat(i)),errorMessage:r==null?void 0:r.errors.rate})}),e(V,{leftSide:l("status"),children:e(ye,{value:t.status_id,onChange:i=>i&&u("status_id",i.id),onClearButtonClick:()=>u("status_id",""),readonly:n.taskModal,errorMessage:r==null?void 0:r.errors.status_id})}),t&&((p=h==null?void 0:h.custom_fields)==null?void 0:p.task3)&&e(E,{field:"task3",defaultValue:t.custom_value3||"",value:h.custom_fields.task3,onValueChange:i=>u("custom_value3",i)}),t&&((k=h==null?void 0:h.custom_fields)==null?void 0:k.task4)&&e(E,{field:"task4",defaultValue:t.custom_value4||"",value:h.custom_fields.task4,onValueChange:i=>u("custom_value4",i)})]}),N.pathname.endsWith("/edit")&&e(Y,{className:"col-span-12 xl:col-span-4 h-max px-6",children:g(ge,{tabs:[l("description"),...f||d?[l("custom_fields")]:[]],children:[e("div",{children:e(S,{element:"textarea",value:t.description,onValueChange:i=>u("description",i),errorMessage:r==null?void 0:r.errors.description})}),g("div",{children:[g("span",{className:"text-sm",children:[l("custom_fields"),"  "]}),e(J,{to:"/settings/custom_fields/tasks",className:"capitalize",children:l("click_here")})]})]})}),!N.pathname.endsWith("/edit")&&e(Y,{className:"col-span-12 xl:col-span-4 h-max",withContainer:!0,children:e(S,{label:l("description"),element:"textarea",value:t.description,onValueChange:i=>u("description",i),errorMessage:r==null?void 0:r.errors.description})})]})}export{$e as L,ye as T,O as a,Ne as b,Ve as c,xe as d,Le as e,Re as f,Me as h,j as p};
