import{at as x,Q as p,r as A,e as D,ao as L,ai as E,b as O,c as N,ak as R,u as U,l as z,a as o,D as I,d as T,g as j,U as M,am as G,A as F,bA as Q,a1 as $,X as V,a2 as m,O as _,H as w,af as y,ag as k,aq as J}from"./index-e5ac1c37.js";import{w as K,J as B,K as X,V as H,s as W,u as Y,t as Z,I as tt}from"./react-icons-071f44cd.js";import{u as P}from"./react-query-557fee5a.js";import{p as et}from"./atoms-cf2b0802.js";import{d as nt,c as ot}from"./jotai-4279821d.js";import{u as S}from"./react-i18next-91d47f13.js";import{a as st}from"./react-router-82cc6afb.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function at(){const n=P(),i=nt(x);return(c,a)=>{p.processing(),A("POST",D("/api/v1/projects/bulk"),{action:a,ids:[c]}).then(()=>p.success(`${a}d_project`)).finally(()=>{L(["projects"]),i&&n.invalidateQueries([i])})}}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function it(){const n=P();return async(i,c)=>{let a=null;const l=c==null?void 0:c.map(r=>r.client_id);if(l!=null&&l.length){const r=l[0];if(l.some(d=>d!==r))return a}a=[],p.processing();const h=i.map(r=>n.fetchQuery(["/api/v1/tasks","project_tasks",r,"active"],()=>A("GET",D("/api/v1/tasks?project_tasks=:projectId&per_page=100&status=active",{projectId:r})),{staleTime:1/0}).then(u=>{const d=u.data.data.filter(f=>!f.invoice_id);a!==null&&(a=[...a,...d])}));return p.dismiss(),await Promise.all(h),a}}const rt=["name","task_rate","due_date","public_notes","private_notes","budgeted_hours","entity_state"];function ct(){const[n,i,c,a]=E({entity:"project"});return["name","client","task_rate","due_date","public_notes","private_notes","budgeted_hours","entity_state","archived_at","created_at",n,i,c,a,"documents","is_deleted","number","updated_at","total_hours"]}function ft(){var s;const{t:n}=S(),{dateFormat:i}=O(),c=N(),a=R(),l=U(),h=z();ct();const[r,u,d,f]=E({entity:"project"}),b=[{column:"name",id:"name",label:n("name"),format:(t,e)=>o(I,{to:T("/projects/:id",{id:e.id}),renderSpan:c("project",e),children:t})},{column:"client",id:"client_id",label:n("client"),format:(t,e)=>e.client&&o(I,{to:T("/clients/:id",{id:t.toString()}),renderSpan:c("client",e.client),children:e.client.display_name})},{column:"task_rate",id:"task_rate",label:n("task_rate"),format:(t,e)=>{var C,v;return l(t,(C=e.client)==null?void 0:C.country_id,(v=e.client)==null?void 0:v.settings.currency_id)}},{column:"due_date",id:"due_date",label:n("due_date"),format:t=>j(t,i)},{column:"public_notes",id:"public_notes",label:n("public_notes"),format:t=>o(M,{size:"regular",truncate:!0,containsUnsafeHTMLTags:!0,message:t,children:o("span",{dangerouslySetInnerHTML:{__html:t}})})},{column:"private_notes",id:"private_notes",label:n("private_notes"),format:t=>o(M,{size:"regular",truncate:!0,containsUnsafeHTMLTags:!0,message:t,children:o("span",{dangerouslySetInnerHTML:{__html:t}})})},{column:"budgeted_hours",id:"budgeted_hours",label:n("budgeted_hours"),format:t=>t},{column:"total_hours",id:"current_hours",label:n("total_hours"),format:t=>t},{column:"entity_state",id:"id",label:n("entity_state"),format:(t,e)=>o(G,{entity:e})},{column:"archived_at",id:"archived_at",label:n("archived_at"),format:t=>j(t,i)},{column:"created_at",id:"created_at",label:n("created_at"),format:t=>j(t,i)},{column:r,id:"custom_value1",label:r,format:t=>a("project1",t==null?void 0:t.toString())},{column:u,id:"custom_value2",label:u,format:t=>a("project2",t==null?void 0:t.toString())},{column:d,id:"custom_value3",label:d,format:t=>a("project3",t==null?void 0:t.toString())},{column:f,id:"custom_value4",label:f,format:t=>a("project4",t==null?void 0:t.toString())},{column:"documents",id:"documents",label:n("documents"),format:(t,e)=>e.documents.length},{column:"is_deleted",id:"is_deleted",label:n("is_deleted"),format:(t,e)=>e.is_deleted?n("yes"):n("no")},{column:"number",id:"number",label:n("number")},{column:"updated_at",id:"updated_at",label:n("updated_at"),format:t=>j(t,i)}],g=((s=h==null?void 0:h.react_table_columns)==null?void 0:s.project)||rt;return b.filter(t=>g.includes(t.column)).sort((t,e)=>g.indexOf(t.column)-g.indexOf(e.column))}function gt(){const[n]=S(),i=st(),c=F(),a=P(),l=at(),h=Q(),{isEditOrShowPage:r,isShowPage:u}=$({entity:"project",editPageTabs:["documents"]}),d=ot(et),f=e=>{d({...e,id:"",documents:[],number:""}),i("/projects/create?action=clone")},b=e=>{p.processing(),a.fetchQuery(["/api/v1/tasks","project_tasks",e.id,"per_page",100,"status","active"],()=>A("GET",D("/api/v1/tasks?project_tasks=:projectId&per_page=100&status=active",{projectId:e.id})),{staleTime:1/0}).then(C=>{p.dismiss();const v=C.data.data.filter(q=>!q.invoice_id);if(!C.data.data.length)return p.error("no_assigned_tasks");h(v)})},{setChangeTemplateResources:g,setChangeTemplateVisible:s}=V();return[e=>u&&o(m,{onClick:()=>i(T("/projects/:id/edit",{id:e.id})),icon:o(_,{element:K}),children:n("edit")}),()=>u&&o(w,{withoutPadding:!0}),e=>c("create_invoice")&&o(m,{onClick:()=>b(e),icon:o(_,{element:B}),children:n("invoice_project")}),e=>c("create_project")&&o(m,{onClick:()=>f(e),icon:o(_,{element:X}),children:n("clone")}),e=>o(m,{onClick:()=>{s(!0),g([e])},icon:o(_,{element:H}),children:n("run_template")}),()=>r&&o(w,{withoutPadding:!0}),e=>y(e)===k.Active&&r&&o(m,{onClick:()=>l(e.id,"archive"),icon:o(_,{element:W}),children:n("archive")}),e=>(y(e)===k.Archived||y(e)===k.Deleted)&&r&&o(m,{onClick:()=>l(e.id,"restore"),icon:o(_,{element:Y}),children:n("restore")}),e=>(y(e)===k.Active||y(e)===k.Archived)&&r&&o(m,{onClick:()=>l(e.id,"delete"),icon:o(_,{element:Z}),children:n("delete")})]}const bt=()=>{const[n]=S(),i=Q(),c=it(),a=F(),l=J(),h=s=>{if(s&&!s.length)return p.error("no_assigned_tasks");if(!s)return p.error("multiple_client_error");i(s)},r=s=>s.some(({documents:t})=>t.length),u=s=>s.flatMap(({documents:t})=>t.map(({id:e})=>e)),d=(s,t)=>{const e=u(s);l(e,"download"),t([])},{setChangeTemplateVisible:f,setChangeTemplateResources:b}=V();return[({selectedIds:s,selectedResources:t,setSelected:e})=>a("create_invoice")&&o(m,{onClick:async()=>{h(await c(s,t)),e([])},icon:o(_,{element:B}),children:n("invoice_project")}),({selectedResources:s,setSelected:t})=>o(m,{onClick:()=>r(s)?d(s,t):p.error("no_documents_to_download"),icon:o(_,{element:tt}),children:n("documents")}),({selectedResources:s})=>o(m,{onClick:()=>{f(!0),b(s)},icon:o(_,{element:H}),children:n("run_template")})]};export{gt as a,bt as b,ct as c,rt as d,ft as u};
