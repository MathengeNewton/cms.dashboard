import{ci as _,j as C,bU as E,a as r,C as b,G as d,aH as k,df as x,aE as D,Q as u,r as T,e as B,ao as P,d as V,aT as q,aU as w}from"./index-ecbcc3c7.js";import{D as M}from"./DesignSelector-1def70e7.js";import{u as Q}from"./designs-863b1b5c.js";import"./react-redux-7b717b6c.js";import"./classnames-eea0979a.js";import{r as l}from"./react-e483b31d.js";import{C as R}from"./CustomDesignsPlanAlert-76e60409.js";import{d as U}from"./@monaco-editor-d5158091.js";import{u as A}from"./react-i18next-91d47f13.js";import{a as F}from"./react-router-82cc6afb.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./lodash-bd2b80f6.js";import"./dayjs-75976aa4.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./react-query-557fee5a.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@azure-485fd2d4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./jotai-c7720f6e.js";import"./react-router-dom-67fe6288.js";import"./@remix-run-dd360fb4.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-debounce-input-20b6d49d.js";import"./lodash.debounce-ddb7250b.js";import"./@headlessui-220c51a1.js";import"./react-icons-071f44cd.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./react-string-replace-e94ae631.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./state-local-dd516420.js";const G=["invoice","payment","client","quote","credit","purchase_order","project","task"];function Ri(){const{t:m}=A(),{data:g}=Q(),[o,p]=l.useState(null),[e,c]=l.useState(null),h=(t,i)=>{p(n=>n&&{...n,[t]:i})};l.useEffect(()=>(g&&p(g),()=>p(null)),[g]);const y=F();_({onClick(){u.processing(),c(null),T("POST",B("/api/v1/designs"),o).then(t=>{u.success("design_created"),P(["designs"]),y(V("/settings/invoice_design/custom_designs/:id/edit",{id:t.data.data.id}))}).catch(t=>{var i;((i=t.response)==null?void 0:i.status)===422&&(u.dismiss(),c(t.response.data))})},disableSaveButton:!q()&&!w()},[o]);const[s,S]=l.useState("design"),v=t=>{if(t==="template"){p(i=>i&&{...i,is_template:!0,design:{...i.design,header:" ",body:i.design.body.length>0?i.design.body:`<html>
	<head>
	</head>
	<body>
		<ninja>

		</ninja>
	</body>
</html>
`,footer:" ",includes:" "}});return}if(t==="design"){p(i=>i&&{...i,is_template:!1,design:{...i.design,header:"",body:"",footer:"",includes:""},entities:""});return}},j=(t,i)=>{if(!o)return;const f=(o.entities.length>1?o.entities.split(",")||[]:[]).filter(a=>a!==t);i&&f.push(t),p(a=>a&&{...a,entities:f.join(",")})};return C(E,{children:[r(R,{}),C(b,{title:m("new_design"),children:[r(d,{leftSide:m("name"),children:r(k,{value:o==null?void 0:o.name,errorMessage:e==null?void 0:e.errors.name,onValueChange:t=>h("name",t)})}),r(d,{leftSide:m("type"),children:r(x,{name:"type",options:[{id:"design",title:m("design"),value:"design"},{id:"template",title:m("template"),value:"template"}],defaultSelected:s,onValueChange:t=>{S(t),v(t)}})}),s==="design"?r(d,{leftSide:m("design"),children:r(M,{onChange:t=>h("design",t.design),actionVisibility:!1,errorMessage:(e==null?void 0:e.errors["design.header"])||(e==null?void 0:e.errors["design.body"])||(e==null?void 0:e.errors["design.footer"])||(e==null?void 0:e.errors["design.includes"])})}):null,s==="template"?r(d,{leftSide:m("resource"),children:G.map(t=>r(D,{label:m(t),value:t,onValueChange:(i,n)=>j(i,!!n),checked:o==null?void 0:o.entities.includes(t)},t))}):null]}),s==="template"?r(b,{title:m("import"),withContainer:!0,collapsed:!0,children:r(U,{height:"15rem",defaultLanguage:"html",value:o==null?void 0:o.design.body,options:{minimap:{enabled:!1}},onChange:t=>t&&p(i=>i&&{...i,design:{...i.design,body:t}})})}):null]})}export{Ri as default,G as templateEntites};
