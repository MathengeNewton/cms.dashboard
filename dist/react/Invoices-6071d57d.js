import{A as j,E as W,c as K,u as X,b as Y,r as D,e as V,a as i,R as Z,j as r,T as ee,G as c,g as d,H as M,I as ie,J as E,K as te,O as G,P as ne,Q as se,U as re,N as H,D as oe,y as le,z as P,d as R,v as ae,V as me,W as ce,l as de,X as pe,x as ue,f as he,Y as fe,Z as _e,_ as q,F as be,$ as ge}from"./index-e5ac1c37.js";import{u as Q}from"./Actions-d8a9753d.js";import{u as ve,a as xe,d as Ce}from"./useInvoiceColumns-1c3431ff.js";import{D as ye}from"./DataTableColumnsPicker-e6b5c621.js";import{I as Se}from"./ImportButton-1d04ed88.js";import{u as Ne,a as Te}from"./useFooterColumns-ebff7a9a.js";import{c as Ie}from"./classnames-eea0979a.js";import{r as N}from"./react-e483b31d.js";import"./react-debounce-input-20b6d49d.js";import"./react-redux-7b717b6c.js";import{S as ke}from"./Slider-3903b35c.js";import{u as we,a as O}from"./react-query-557fee5a.js";import{P as Ae}from"./PaymentStatus-4a5a4ead.js";import{I as Ee}from"./InvoiceStatus-82691a21.js";import{bn as U,bx as Pe}from"./dayjs-75976aa4.js";import{U as Re,x as Fe,d as $e}from"./react-icons-071f44cd.js";import{r as De}from"./react-string-replace-e94ae631.js";import{E as Ve}from"./EmailRecord-44086238.js";import{u as B}from"./react-i18next-91d47f13.js";import{b as L,u as F}from"./jotai-4279821d.js";import{D as qe}from"./DataTableFooterColumnsPicker-ffc8e60e.js";import"./hoist-non-react-statics-2fceee1f.js";import"./@babel-e5cbf021.js";import"./react-is-e8e5dbb3.js";import"./lodash-bd2b80f6.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./@azure-485fd2d4.js";import"./react-router-82cc6afb.js";import"./@remix-run-dd360fb4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./react-router-dom-67fe6288.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-dom-ce3e84ee.js";import"./scheduler-765c72db.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./use-sync-external-store-7794fa59.js";import"./lodash.debounce-ddb7250b.js";import"./invoice-status-756326ba.js";import"./useDownloadPdfs-1d8bff4b.js";import"./payments-292c2f42.js";import"./atoms-3ec35d22.js";import"./useSumTableColumn-02c51a24.js";import"./payment-status-51e1486d.js";const z=L(null),J=L(!1);U.extend(Pe);function Be(){const[u]=B();return s=>{var n,b,g,h,v,f,_,m,x;let e=le(`activity_${s.activity_type_id}`,{});const C={client:i(P,{to:R("/clients/:id",{id:(n=s.client)==null?void 0:n.hashed_id}),children:(b=s.client)==null?void 0:b.label}),user:((g=s.user)==null?void 0:g.label)??u("system"),invoice:i(P,{to:R("/invoices/:id/edit",{id:(h=s.invoice)==null?void 0:h.hashed_id}),children:(v=s==null?void 0:s.invoice)==null?void 0:v.label})??"",recurring_invoice:i(P,{to:R("/recurring_invoices/:id/edit",{id:(f=s==null?void 0:s.recurring_invoice)==null?void 0:f.hashed_id}),children:(_=s==null?void 0:s.recurring_invoice)==null?void 0:_.label})??"",contact:i(P,{to:R("/clients/:id/edit",{id:(m=s==null?void 0:s.contact)==null?void 0:m.hashed_id}),children:(x=s==null?void 0:s.contact)==null?void 0:x.label})??""};for(const[a,o]of Object.entries(C))e=De(e,`:${a}`,()=>o);return e}}function Me(){var I,k,w,A;const[u,s]=F(J),[e,C]=F(z),[n]=B(),b=j(),g=W(),h=K(),[v,f]=N.useState([]),_=we(),m=X(),x=Q({showCommonBulkAction:!0,showEditAction:!0}),{dateFormat:a}=Y(),{data:o}=O({queryKey:["/api/v1/invoices",e==null?void 0:e.id,"payments"],queryFn:()=>D("GET",V(`/api/v1/invoices/${e==null?void 0:e.id}?include=payments,activities.history&reminder_schedule=true`)).then(t=>t.data.data),enabled:e!==null&&u,staleTime:1/0}),T=async()=>{const t=await _.fetchQuery(["/api/v1/invoices",e==null?void 0:e.id,"emailHistory"],()=>D("POST",V("/api/v1/emails/entityHistory"),{entity:"invoice",entity_id:e==null?void 0:e.id}),{staleTime:1/0}).then(l=>l.data);f(t)};N.useEffect(()=>{e&&T()},[e]);const{data:y}=O({queryKey:["/api/v1/activities/entity",e==null?void 0:e.id],queryFn:()=>D("POST",V("/api/v1/activities/entity"),{entity:"invoice",entity_id:e==null?void 0:e.id}).then(t=>t.data.data),enabled:e!==null&&u,staleTime:1/0}),$=Be();return i(ke,{visible:u,onClose:()=>{s(!1),C(null)},size:"regular",title:`${n("invoice")} ${e==null?void 0:e.number}`,topRight:e&&(b("edit_invoice")||g(e))?i(Z,{label:n("more_actions"),resource:e,actions:x}):null,withoutActionContainer:!0,children:r(ee,{tabs:[n("overview"),n("history"),n("activity"),n("email_history")],width:"full",children:[r("div",{className:"space-y-2",children:[r("div",{children:[i(c,{leftSide:n("invoice_amount"),children:e?m(e==null?void 0:e.amount,(I=e.client)==null?void 0:I.country_id,(k=e.client)==null?void 0:k.settings.currency_id):null}),i(c,{leftSide:n("balance_due"),children:e?m(e.balance,(w=e.client)==null?void 0:w.country_id,(A=e.client)==null?void 0:A.settings.currency_id):null}),i(c,{leftSide:n("date"),children:e?d(e==null?void 0:e.date,a):null}),i(c,{leftSide:n("due_date"),children:e?d(e.due_date,a):null}),i(c,{leftSide:n("status"),children:e?i(Ee,{entity:e}):null})]}),i(M,{withoutPadding:!0}),r(ie,{className:"w-full",children:[i(E,{className:"text-center",onClick:()=>e?te(e):null,children:r("div",{className:"inline-flex items-center space-x-1",children:[i(G,{element:Re}),i("p",{children:n("view_portal")})]})}),e?i(E,{className:"text-center",onClick:()=>{navigator.clipboard.writeText(ne(e)??""),se.success("copied_to_clipboard",{value:""})},children:r("div",{className:"inline-flex items-center space-x-1",children:[i(G,{element:Fe}),i("p",{children:n("copy_link")})]})}):null]}),i(M,{withoutPadding:!0}),e&&e.next_send_date?r("div",{className:"space-y-2 whitespace-nowrap",children:[i(re,{size:"regular",width:"auto",containsUnsafeHTMLTags:!0,message:(o==null?void 0:o.reminder_schedule)??"",children:r("h3",{className:"flex ml-3 mt-2 italic",children:[n("reminders")," ",i($e,{className:"mt-1 ml-1"})]})}),i(c,{leftSide:n("next_send_date"),children:e?d(e.next_send_date,a):null}),i(c,{leftSide:n("reminder_last_sent"),children:e?d(e.reminder_last_sent,a):null}),e.reminder1_sent?i(c,{leftSide:n("first_reminder"),children:e?d(e.reminder1_sent,a):null}):null,e.reminder2_sent?i(c,{leftSide:n("second_reminder"),children:e?d(e.reminder2_sent,a):null}):null,e.reminder3_sent?i(c,{leftSide:n("third_reminder"),children:e?d(e.reminder3_sent,a):null}):null]}):null,i("div",{className:"divide-y",children:(o==null?void 0:o.payments)&&o.payments.map(t=>t.paymentables.filter(l=>l.invoice_id==(e==null?void 0:e.id)&&l.archived_at==0).map(l=>{var p,S;return i(E,{to:`/payments/${t.id}/edit`,disableNavigation:h("payment",t),children:r("div",{className:"flex flex-col space-y-2",children:[r("p",{className:"font-semibold",children:[n("payment")," ",t.number]}),r("p",{className:"inline-flex items-center space-x-1",children:[i("p",{children:m(l.amount,(p=t.client)==null?void 0:p.country_id,(S=t.client)==null?void 0:S.settings.currency_id)}),i("p",{children:"·"}),i("p",{children:d(l.created_at,a)})]}),i("div",{children:i(Ae,{entity:t})})]})},t.id)}))})]}),r("div",{children:[(o==null?void 0:o.activities)&&o.activities.length===0&&i(H,{children:n("nothing_to_see_here")}),(o==null?void 0:o.activities)&&o.activities.map(t=>{var l,p,S;return i(E,{to:`/activities/${t.id}`,children:r("div",{className:"flex flex-col",children:[r("div",{className:"flex space-x-1",children:[i("span",{children:e!=null&&e.client?m(t.history.amount,(l=e==null?void 0:e.client)==null?void 0:l.country_id,(p=e==null?void 0:e.client)==null?void 0:p.settings.currency_id):null}),i("span",{children:"·"}),i(oe,{to:`/clients/${t.client_id}`,renderSpan:h("client",e==null?void 0:e.client),children:(S=e==null?void 0:e.client)==null?void 0:S.display_name})]}),r("div",{className:"inline-flex items-center space-x-1",children:[i("p",{children:d(t.created_at,`${a} h:mm:ss A`)}),i("p",{children:U.unix(t.created_at).fromNow()})]})]})},t.id)})]}),i("div",{children:y==null?void 0:y.map(t=>r(H,{className:"flex flex-col",children:[i("p",{children:$(t)}),r("p",{className:"inline-flex items-center space-x-1",children:[i("p",{children:d(t.created_at,`${a} h:mm:ss A`)}),i("p",{children:"·"}),i("p",{children:t.ip})]})]},t.id))}),i("div",{className:"flex flex-col",children:v.map((t,l)=>i(Ve,{className:"py-4",emailRecord:t,index:l},l))})]})})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function Ge(){return[{column:"date",queryParameterKey:"date_range"},{column:"due_date",queryParameterKey:"due_date_range"}]}function Lt(){const{documentTitle:u}=ae("invoices"),[s]=B(),e=[{name:s("invoices"),href:"/invoices"}],C=j(),n=K(),[b,g]=N.useState(""),[h,v]=F(z),[f,_]=F(J),{data:m}=me({id:b}),x=Q(),a=ce(),o=ve(),T=de(),y=xe(),$=Ge(),I=Ne(),{footerColumns:k,allFooterColumns:w}=Te();N.useEffect(()=>{m&&f&&v(m)},[m,f]),N.useEffect(()=>()=>_(!1),[]);const{changeTemplateVisible:A,setChangeTemplateVisible:t,changeTemplateResources:l}=pe();return r(ue,{title:u,breadcrumbs:e,docsLink:"en/invoices",withoutBackButton:!0,children:[i(he,{resource:"invoice",endpoint:"/api/v1/invoices?include=client.group_settings&without_deleted_clients=true&sort=id|desc",columns:o,footerColumns:k,bulkRoute:"/api/v1/invoices/bulk",linkToCreate:"/invoices/create",linkToEdit:"/invoices/:id/edit",withResourcefulActions:!0,customActions:x,customBulkActions:I,customFilters:a,customFilterPlaceholder:"status",rightSide:i(fe,{type:"component",component:i(Se,{route:"/invoices/import"}),guards:[_e(q("create_invoice"),q("edit_invoice"))]}),leftSideChevrons:r("div",{className:Ie("flex items-center space-x-1",{"pr-4":!!T.show_table_footer}),children:[!!T.show_table_footer&&r(be,{children:[i(qe,{table:"invoice",columns:w}),i("span",{children:"|"})]}),i(ye,{table:"invoice",columns:y,defaultColumns:Ce})]}),linkToCreateGuards:[q("create_invoice")],hideEditableOptions:!C("edit_invoice"),onTableRowClick:p=>{g(p.id),_(!0)},dateRangeColumns:$}),!n("invoice",h)&&i(Me,{}),i(ge,{entity:"invoice",entities:l,visible:A,setVisible:t,labelFn:p=>`${s("number")}: ${p.number}`,bulkUrl:"/api/v1/invoices/bulk"})]})}export{Lt as default};
