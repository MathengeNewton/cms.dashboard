import{v as O,az as U,h as z,cb as G,cc as Q,cd as V,a as i,O as y,j as C,x as W,C as q,T as H,aA as k,aB as s,S,a6 as J,ce as K}from"./index-e5ac1c37.js";import{b as X}from"./blank-invitation-ca06b7b6.js";import{y as T}from"./lodash-bd2b80f6.js";import{C as Z}from"./ClientSelector-9a053f9d.js";import{u as $,I as tt,a as et}from"./useProductColumns-2a17b8dd.js";import{r as u}from"./react-e483b31d.js";import{u as it}from"./react-router-dom-67fe6288.js";import{I as ot,a as rt,C as nt,c as at}from"./ConfirmActionModal-69e2a046.js";import{N as st,Y as mt}from"./react-icons-071f44cd.js";import{bn as pt}from"./dayjs-75976aa4.js";import"./classnames-eea0979a.js";import{u as ct}from"./useTaskColumns-2c288712.js";import{u as lt}from"./react-i18next-91d47f13.js";import{u as v}from"./jotai-4279821d.js";import"./react-redux-7b717b6c.js";import"./react-dom-ce3e84ee.js";import"./@babel-e5cbf021.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-2fceee1f.js";import"./react-is-e8e5dbb3.js";import"./use-sync-external-store-7794fa59.js";import"./i18next-076b76a4.js";import"./axios-60492c0c.js";import"./react-hot-toast-d3a0fddd.js";import"./goober-70b4b9ca.js";import"./react-query-557fee5a.js";import"./@azure-485fd2d4.js";import"./react-router-82cc6afb.js";import"./@remix-run-dd360fb4.js";import"./@reduxjs-3eb15742.js";import"./immer-85efa438.js";import"./redux-fc7ec223.js";import"./reselect-26feef0e.js";import"./redux-thunk-ef899f4c.js";import"./styled-components-2e13d465.js";import"./tslib-b7af3ea6.js";import"./@emotion-4a2a218f.js";import"./stylis-60528643.js";import"./react-datepicker-27eb8381.js";import"./react-debounce-input-20b6d49d.js";import"./lodash.debounce-ddb7250b.js";import"./@headlessui-220c51a1.js";import"./react-feather-90dbe0b6.js";import"./prop-types-20aec754.js";import"./@tippyjs-11b6b10a.js";import"./tippy.js-87d3e7d2.js";import"./@popperjs-0aa08b12.js";import"./formik-4b8c99cc.js";import"./deepmerge-15f827de.js";import"./lodash-es-87d1a1d5.js";import"./react-fast-compare-76c36d98.js";import"./tiny-warning-c932d744.js";import"./react-use-57961871.js";import"./react-phone-number-input-4fffe465.js";import"./react-verification-input-7fc81ee7.js";import"./collect.js-ebd014c9.js";import"./uuid-4a60fe23.js";import"./react-colorful-fdedf134.js";import"./@react-oauth-6ebaa241.js";import"./react-qr-code-d89187e6.js";import"./qr.js-8bf59ccc.js";import"./react-select-0a6a834e.js";import"./@floating-ui-f24065be.js";import"./use-isomorphic-layout-effect-90624eb0.js";import"./memoize-one-297ddbcb.js";import"./@hello-pangea-bfa72c9a.js";import"./use-memo-one-4ec633fc.js";import"./css-box-model-096cf826.js";import"./tiny-invariant-bee4f299.js";import"./raf-schd-5404ed65.js";import"./array-move-3ca81c74.js";import"./antd-c1c66b30.js";import"./rc-util-6b529ca7.js";import"./@ant-design-6511c079.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-f83f8b7d.js";import"./rc-motion-e4fc5c25.js";import"./rc-picker-0dcad4af.js";import"./@rc-component-79b9f5ef.js";import"./rc-pagination-2b5394e8.js";import"./rc-field-form-4872bfbf.js";import"./async-validator-dee29e8b.js";import"./@tinymce-7238a8f2.js";import"./pretty-bytes-5eb460d8.js";import"./react-dropzone-eadb3dbd.js";import"./file-selector-6cb2a621.js";import"./attr-accept-6df8d728.js";import"./react-string-replace-e94ae631.js";import"./currency.js-57f74176.js";import"./react-json-tree-c223e40a.js";import"./react-base16-styling-898a7ddc.js";import"./base16-823cae66.js";import"./color-65b618c9.js";import"./color-string-f5cd3c3e.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-58fb3c22.js";import"./color-convert-946e453a.js";import"./lodash.curry-52fa8793.js";import"./react-turnstile-a0253d8c.js";import"./mitt-f7ef348c.js";import"./@sentry-71948bea.js";import"./@sentry-internal-c0f5a295.js";import"./InvoiceViewer-d9cf5b5b.js";import"./ProjectSelector-c72052c6.js";import"./DesignSelector-512fb715.js";import"./designs-ceef87ad.js";function li(){const{documentTitle:P}=O("new_recurring_invoice"),{t:m}=lt(),w=[{name:m("recurring_invoices"),href:"/recurring_invoices"},{name:m("new_recurring_invoice"),href:"/recurring_invoices/create"}],[t,g]=v(J),[D]=v(K),[L,A]=u.useState(),[c,M]=u.useState(),[p]=it(),R=U(),e=z(),E=$(),{handleChange:a,calculateInvoiceSum:N,handleInvitationChange:Y,handleLineItemChange:h,handleLineItemPropertyChange:x,handleCreateLineItem:I,handleDeleteLineItem:b}=G({client:L}),{data:_}=Q({enabled:typeof t>"u"});u.useEffect(()=>(g(o=>{var l,d;let n=o;if(p.get("action")!=="clone"&&(n=void 0),typeof _<"u"&&typeof n>"u"&&p.get("action")!=="clone"){const r=T.cloneDeep(_);e&&e.enabled_tax_rates>0&&(r.tax_name1=e.settings.tax_name1,r.tax_rate1=e.settings.tax_rate1),e&&e.enabled_tax_rates>1&&(r.tax_name2=e.settings.tax_name2,r.tax_rate2=e.settings.tax_rate2),e&&e.enabled_tax_rates>2&&(r.tax_name3=e.settings.tax_name3,r.tax_rate3=e.settings.tax_rate3),typeof r.line_items=="string"&&(r.line_items=[]),p.get("client")&&(r.client_id=p.get("client")),r.next_send_date===""&&(r.next_send_date=pt().format("YYYY-MM-DD")),r.uses_inclusive_taxes=((l=e==null?void 0:e.settings)==null?void 0:l.inclusive_taxes)??!1,r.auto_bill=((d=e==null?void 0:e.settings)==null?void 0:d.auto_bill)??"off",n=r}return n}),()=>{g(void 0)}),[_]),u.useEffect(()=>{t&&N(t)},[t]),u.useEffect(()=>{t&&t.client_id.length>1&&R.find(t.client_id).then(o=>{A(o);const n=[];o.contacts.map(l=>{if(l.send_email){const d=T.cloneDeep(X);d.client_contact_id=l.id,n.push(d)}}),a("invitations",n)})},[t==null?void 0:t.client_id]);const f=V({setErrors:M}),[,j]=v(at),B=[{onClick:()=>j(!0),label:m("send_now"),icon:i(y,{element:st})},{onClick:()=>f(t,"start"),label:m("start"),icon:i(y,{element:mt})}],F=ct();return C(W,{title:P,breadcrumbs:w,disableSaveButton:!(t!=null&&t.client_id),onSaveClick:()=>f(t),additionalSaveOptions:B,children:[C("div",{className:"grid grid-cols-12 gap-4",children:[i(q,{className:"col-span-12 xl:col-span-4 h-max",withContainer:!0,children:i(Z,{resource:t,onChange:o=>a("client_id",o),onClearButtonClick:()=>a("client_id",""),onContactCheckboxChange:Y,errorMessage:c==null?void 0:c.errors.client_id,disableWithSpinner:p.get("action")==="create"})}),i(ot,{handleChange:a,errors:c}),i("div",{className:"col-span-12",children:C(H,{tabs:[m("products"),m("tasks")],defaultTabIndex:p.get("table")==="tasks"?1:0,children:[i("div",{children:t?i(k,{type:"product",resource:t,items:t.line_items.filter(o=>[s.Product,s.UnpaidFee,s.PaidFee,s.LateFee].includes(o.type_id)),columns:E,relationType:"client_id",onLineItemChange:h,onSort:o=>a("line_items",o),onLineItemPropertyChange:x,onCreateItemClick:()=>I(s.Product),onDeleteRowClick:b}):i(S,{})}),i("div",{children:t?i(k,{type:"task",resource:t,items:t.line_items.filter(o=>o.type_id===s.Task),columns:F,relationType:"client_id",onLineItemChange:h,onSort:o=>a("line_items",o),onLineItemPropertyChange:x,onCreateItemClick:()=>I(s.Task),onDeleteRowClick:b}):i(S,{})})]})}),i(rt,{handleChange:a,errors:c}),t&&i(tt,{relationType:"client_id",resource:t,invoiceSum:D,onChange:(o,n)=>a(o,n)})]}),i("div",{className:"my-4",children:t&&i(et,{for:"create",resource:t,entity:"recurring_invoice",relationType:"client_id",endpoint:"/api/v1/live_preview?entity=:entity"})}),i(nt,{onClick:()=>f(t,"send_now")})]})}export{li as default};
