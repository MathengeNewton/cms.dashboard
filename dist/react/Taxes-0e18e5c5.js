import{h as T,u as P,j as x,a,C as y,G as s,F as D,aH as u,aO as Y,aD as w,dd as H,aN as L,aY as M,s as I,o as j,aI as C,bI as O,as as p,a9 as q,D as R,df as W}from"./index-e5ac1c37.js";import"./react-redux-7b717b6c.js";import{u as G}from"./react-router-dom-67fe6288.js";import"./classnames-eea0979a.js";import{P as U}from"./ProjectSelector-c72052c6.js";import{i as z,j as A}from"./hooks-2a87889a.js";import{bn as N}from"./dayjs-75976aa4.js";import{u as S}from"./react-i18next-91d47f13.js";import{r as V}from"./react-e483b31d.js";import{P as J}from"./PaymentTypeSelector-baaa0894.js";import"./react-debounce-input-20b6d49d.js";function re(h){var m,v,c,B,k,F;const[l]=S(),[d]=G(),{recurringExpense:e,handleChange:t,taxInputType:o,pageType:_,errors:r}=h,i=T(),f=P(),g=O();return x("div",{className:"flex flex-col space-y-4",children:[e&&a(y,{children:a(s,{leftSide:l("expense_total"),withoutWrappingLeftSide:!0,children:f(g(e),(m=e.client)==null?void 0:m.country_id,e.currency_id||((v=e.client)==null?void 0:v.settings.currency_id))})}),x(y,{title:l("details"),isLoading:!e,children:[e&&_==="edit"&&x(D,{children:[a(s,{leftSide:l("status"),children:a(z,{recurringExpense:e})}),a(s,{leftSide:l("number"),children:a(u,{id:"number",value:e.number,onValueChange:n=>t("number",n),errorMessage:r==null?void 0:r.errors.number})})]}),e&&a(s,{leftSide:l("vendor"),children:a(Y,{value:e.vendor_id,onChange:n=>t("vendor_id",n.id),onClearButtonClick:()=>t("vendor_id",""),errorMessage:r==null?void 0:r.errors.vendor_id})}),e&&a(s,{leftSide:l("client"),children:a(w,{value:e.client_id,clearButton:!!e.client_id,onClearButtonClick:()=>t("client_id",""),onChange:n=>t("client_id",n.id),errorMessage:r==null?void 0:r.errors.client_id,disableWithSpinner:d.get("action")==="create"})}),e&&a(s,{leftSide:l("project"),children:a(U,{value:e.project_id,clearButton:!!e.project_id,onClearButtonClick:()=>t("project_id",""),onChange:n=>t("project_id",n.id),errorMessage:r==null?void 0:r.errors.project_id})}),e&&a(s,{leftSide:l("category"),children:a(H,{value:e.category_id,onClearButtonClick:()=>t("category_id",""),onChange:n=>t("category_id",n.id),errorMessage:r==null?void 0:r.errors.category_id})}),e&&a(s,{leftSide:l("user"),children:a(L,{value:e.assigned_user_id,clearButton:!!e.assigned_user_id,onClearButtonClick:()=>t("assigned_user_id",""),onChange:n=>t("assigned_user_id",n.id),errorMessage:r==null?void 0:r.errors.assigned_user_id})}),e&&(i==null?void 0:i.enabled_expense_tax_rates)>0&&o==="by_rate"&&a(s,{leftSide:l("tax"),children:a(M,{defaultValue:e.tax_name1,onClearButtonClick:()=>{t("tax_name1",""),t("tax_rate1",0)},onChange:n=>{n.resource&&t("tax_rate1",n.resource.rate),n.resource&&t("tax_name1",n.resource.name)},onTaxCreated:n=>{t("tax_rate1",n.rate),t("tax_name1",n.name)}})}),e&&(i==null?void 0:i.enabled_expense_tax_rates)>0&&o==="by_amount"&&a(s,{leftSide:l("tax"),children:x("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[a(u,{label:l("tax_name"),value:e.tax_name1,onValueChange:n=>t("tax_name1",n),errorMessage:r==null?void 0:r.errors.tax_name1,cypressRef:"taxNameByAmount1"}),a(u,{type:"number",label:l("tax_amount"),value:e.tax_amount1,onValueChange:n=>t("tax_amount1",parseFloat(n)),errorMessage:r==null?void 0:r.errors.tax_amount1,cypressRef:"taxRateByAmount1"})]})}),e&&(i==null?void 0:i.enabled_expense_tax_rates)>1&&o==="by_rate"&&a(s,{leftSide:l("tax"),children:a(M,{defaultValue:e.tax_name2,onClearButtonClick:()=>{t("tax_name2",""),t("tax_rate2",0)},onChange:n=>{n.resource&&t("tax_rate2",n.resource.rate),n.resource&&t("tax_name2",n.resource.name)},onTaxCreated:n=>{t("tax_rate2",n.rate),t("tax_name2",n.name)}})}),e&&(i==null?void 0:i.enabled_expense_tax_rates)>1&&o==="by_amount"&&a(s,{leftSide:l("tax"),children:x("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[a(u,{label:l("tax_name"),value:e.tax_name2,onValueChange:n=>t("tax_name2",n),errorMessage:r==null?void 0:r.errors.tax_name2,cypressRef:"taxNameByAmount2"}),a(u,{type:"number",label:l("tax_amount"),value:e.tax_amount2,onValueChange:n=>t("tax_amount2",parseFloat(n)),errorMessage:r==null?void 0:r.errors.tax_amount2,cypressRef:"taxRateByAmount2"})]})}),e&&(i==null?void 0:i.enabled_expense_tax_rates)>2&&o==="by_rate"&&a(s,{leftSide:l("tax"),children:a(M,{defaultValue:e.tax_name3,onClearButtonClick:()=>{t("tax_name3",""),t("tax_rate3",0)},onChange:n=>{n.resource&&t("tax_rate3",n.resource.rate),n.resource&&t("tax_name3",n.resource.name)},onTaxCreated:n=>{t("tax_rate3",n.rate),t("tax_name3",n.name)}})}),e&&(i==null?void 0:i.enabled_expense_tax_rates)>2&&o==="by_amount"&&a(s,{leftSide:l("tax"),children:x("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[a(u,{label:l("tax_name"),value:e.tax_name3,onValueChange:n=>t("tax_name3",n),errorMessage:r==null?void 0:r.errors.tax_name3}),a(u,{type:"number",label:l("tax_amount"),value:e.tax_amount3,onValueChange:n=>t("tax_amount3",parseFloat(n)),errorMessage:r==null?void 0:r.errors.tax_amount3})]})}),e&&a(s,{leftSide:l("amount"),children:a(u,{type:"number",value:e.amount,onValueChange:n=>t("amount",parseFloat(n)||0),errorMessage:r==null?void 0:r.errors.amount})}),e&&a(s,{leftSide:l("currency"),children:a(I,{value:e.currency_id,onChange:n=>t("currency_id",n),errorMessage:r==null?void 0:r.errors.currency_id})}),e&&a(s,{leftSide:l("date"),children:a(u,{type:"date",onValueChange:n=>t("date",n),value:e.date,errorMessage:r==null?void 0:r.errors.date})}),a(s,{leftSide:l("frequency"),children:a(j,{value:e==null?void 0:e.frequency_id,onValueChange:n=>t("frequency_id",n),errorMessage:r==null?void 0:r.errors.frequency_id,children:Object.keys(A).map((n,b)=>a("option",{value:n,children:l(A[n])},b))})}),a(s,{leftSide:l("start_date"),children:a(u,{type:"date",onValueChange:n=>t("next_send_date",n),value:e!=null&&e.next_send_date?N(e==null?void 0:e.next_send_date).format("YYYY-MM-DD"):new Date().toISOString().split("T")[0],min:new Date().toISOString().split("T")[0],errorMessage:r==null?void 0:r.errors.next_send_date})}),a(s,{leftSide:l("remaining_cycles"),children:x(j,{value:e==null?void 0:e.remaining_cycles,onValueChange:n=>t("remaining_cycles",parseInt(n)),errorMessage:r==null?void 0:r.errors.remaining_cycles,children:[a("option",{value:"-1",children:l("endless")}),[...Array(37).keys()].map((n,b)=>a("option",{value:n,children:n},b))]})}),e&&((c=i==null?void 0:i.custom_fields)==null?void 0:c.expense1)&&a(C,{field:"recurringExpense1",defaultValue:e.custom_value1||"",value:i.custom_fields.expense1,onValueChange:n=>t("custom_value1",String(n))}),e&&((B=i==null?void 0:i.custom_fields)==null?void 0:B.expense2)&&a(C,{field:"recurringExpense2",defaultValue:e.custom_value2||"",value:i.custom_fields.expense2,onValueChange:n=>t("custom_value2",String(n))}),e&&((k=i==null?void 0:i.custom_fields)==null?void 0:k.expense3)&&a(C,{field:"recurringExpense3",defaultValue:e.custom_value3||"",value:i.custom_fields.expense3,onValueChange:n=>t("custom_value3",String(n))}),e&&((F=i==null?void 0:i.custom_fields)==null?void 0:F.expense4)&&a(C,{field:"recurringExpense4",defaultValue:e.custom_value4||"",value:i.custom_fields.expense4,onValueChange:n=>t("custom_value4",String(n))})]})]})}function ie(h){const[l]=S(),{recurringExpense:d,handleChange:e,errors:t}=h;return x(y,{title:l("notes"),isLoading:!d,withContainer:!0,children:[d&&a(u,{element:"textarea",label:l("public_notes"),value:d.public_notes,onValueChange:o=>e("public_notes",o),errorMessage:t==null?void 0:t.errors.public_notes}),d&&a(u,{element:"textarea",label:l("private_notes"),value:d.private_notes,onValueChange:o=>e("private_notes",o),errorMessage:t==null?void 0:t.errors.private_notes})]})}function oe(h){const[l]=S(),d=T(),{recurringExpense:e,handleChange:t,errors:o}=h,[_,r]=V.useState(),i=()=>!!(e!=null&&e.payment_type_id)||!!(e!=null&&e.payment_date)||!!(e!=null&&e.transaction_reference),f=c=>{if(!c){t("payment_date",""),t("payment_type_id",""),t("transaction_reference","");return}t("payment_date",N().format("YYYY-MM-DD"))},g=c=>{if(!c){t("invoice_currency_id",""),t("exchange_rate",0),t("foreign_amount",0);return}t("exchange_rate",1),t("foreign_amount",e.amount)};V.useEffect(()=>{_&&t("foreign_amount",e.amount*e.exchange_rate)},[e==null?void 0:e.amount]);const m=c=>{t("exchange_rate",parseFloat(c)||1),t("foreign_amount",e.amount*parseFloat(c)||1)},v=c=>{t("foreign_amount",parseFloat(c)||e.amount),t("exchange_rate",parseFloat(c)/e.amount)};return V.useEffect(()=>{e&&typeof _>"u"&&r(!!(d!=null&&d.convert_expense_currency)||!!(e!=null&&e.foreign_amount))},[e]),x(y,{title:l("additional_info"),isLoading:!e,children:[e&&a(s,{leftSide:l("should_be_invoiced"),leftSideHelp:l("mark_invoiceable_help"),children:a(p,{checked:e.should_be_invoiced,onChange:c=>t("should_be_invoiced",c),cypressRef:"shouldBeInvoicedToggle"})}),e&&a(s,{leftSide:l("mark_paid"),leftSideHelp:l("mark_paid_help"),children:a(p,{checked:i(),onChange:f,cypressRef:"markPaidToggle"})}),e&&i()&&a(s,{leftSide:l("payment_type"),children:a(J,{value:e.payment_type_id,onChange:c=>t("payment_type_id",c),errorMessage:o==null?void 0:o.errors.payment_type_id})}),e&&i()&&a(s,{leftSide:l("date"),children:a(u,{type:"date",value:e.payment_date,onValueChange:c=>t("payment_date",c),errorMessage:o==null?void 0:o.errors.payment_date})}),e&&i()&&a(s,{leftSide:l("transaction_reference"),children:a(u,{value:e.transaction_reference,onValueChange:c=>t("transaction_reference",c),errorMessage:o==null?void 0:o.errors.transaction_reference})}),e&&a(s,{leftSide:l("convert_currency"),leftSideHelp:l("convert_currency_help"),children:a(p,{checked:_||!1,onChange:g,cypressRef:"convertCurrencyToggle"})}),e&&_&&x(D,{children:[a(s,{leftSide:l("currency"),children:a(I,{value:e.invoice_currency_id,onChange:c=>t("invoice_currency_id",c),errorMessage:o==null?void 0:o.errors.invoice_currency_id})}),a(s,{leftSide:l("exchange_rate"),children:a(u,{value:e.exchange_rate,onValueChange:m,errorMessage:o==null?void 0:o.errors.exchange_rate})}),a(s,{leftSide:l("converted_amount"),children:a(u,{value:e.foreign_amount,onValueChange:v,errorMessage:o==null?void 0:o.errors.foreign_amount})})]}),e&&a(s,{leftSide:l("add_documents_to_invoice"),leftSideHelp:l("add_documents_to_invoice_help"),children:a(p,{checked:e.invoice_documents,onChange:c=>t("invoice_documents",c),cypressRef:"addDocumentsToInvoiceToggle"})})]})}function se(h){const[l]=S(),d=T(),{isAdmin:e,isOwner:t}=q(),{recurringExpense:o,handleChange:_,taxInputType:r,setTaxInputType:i}=h,f=m=>{m==="by_amount"?(_("tax_rate1",0),_("tax_rate2",0),_("tax_rate3",0)):(_("tax_amount1",0),_("tax_amount2",0),_("tax_amount3",0)),_("tax_name1",""),_("tax_name2",""),_("tax_name3","")},g=m=>{i(m),f(m),_("calculate_tax_by_amount",m==="by_amount")};return x(y,{title:l("taxes"),isLoading:!o,children:[!(d!=null&&d.enabled_expense_tax_rates)&&a(s,{leftSide:l("expense_tax_help"),children:a(R,{to:"/settings/tax_settings",renderSpan:!e&&!t,children:l("settings")})}),(d==null?void 0:d.enabled_expense_tax_rates)>0&&o&&a(s,{leftSide:l("enter_taxes"),children:a(W,{name:"enter_taxes",options:[{id:"by_rate",title:l("by_rate"),value:"by_rate"},{id:"by_amount",title:l("by_amount"),value:"by_amount"}],defaultSelected:r,onValueChange:m=>g(m)})}),(d==null?void 0:d.enabled_expense_tax_rates)>0&&o&&a(s,{leftSide:l("inclusive_taxes"),leftSideHelp:x("span",{className:"flex flex-col",children:[x("span",{children:[l("exclusive"),": 100 + 10% = 100 + 10"]}),x("span",{children:[l("inclusive"),": 100 + 10% = 90.91 + 9.09"]})]}),children:a(p,{checked:o.uses_inclusive_taxes,onChange:m=>_("uses_inclusive_taxes",m),cypressRef:"inclusiveTaxesToggle"})})]})}export{oe as A,re as D,ie as N,se as T};
